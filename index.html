<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ä¸å‹•ç”£å¥‘ç´„é€²æ—ç®¡ç†ï¼ˆã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ï¼‰</title>

  <!-- React 18 UMD -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

  <!-- Babel (ãƒ–ãƒ©ã‚¦ã‚¶ã§JSXå¤‰æ›ç”¨) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- TailwindCSSï¼ˆCDNï¼‰ -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>

  <style>
    body { background: #f7fafc; font-feature-settings: "palt" 1; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    // ====== lucide-react ã®ä»£æ›¿ï¼šç°¡æ˜“SVGã‚¢ã‚¤ã‚³ãƒ³ ======
    const makeIcon = (label) => ({ className = "w-5 h-5", ...rest }) => (
      <svg
        className={className}
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
        aria-label={label}
        {...rest}
      >
        <rect x="3" y="3" width="18" height="18" rx="4" ry="4"></rect>
        <text x="12" y="15" textAnchor="middle" fontSize="8" fontFamily="sans-serif">
          {label?.[0] || "I"}
        </text>
      </svg>
    );

    const Bell = makeIcon('Bell');
    const Plus = makeIcon('Plus');
    const X = makeIcon('X');
    const Calendar = makeIcon('Cal');
    const User = makeIcon('User');
    const Building2 = makeIcon('Bld');
    const AlertCircle = makeIcon('!');
    const Check = makeIcon('OK');
    const Clock = makeIcon('Clk');
    const ChevronRight = makeIcon('>');
    const Users = makeIcon('Usr');
    const MapPin = makeIcon('Pin');
    const Briefcase = makeIcon('Job');
    const DollarSign = makeIcon('Â¥');
    const FileText = makeIcon('Doc');
    const Upload = makeIcon('Up');
    const TrendingUp = makeIcon('UpT');
    const BarChart3 = makeIcon('Bar');
    const Search = makeIcon('Srch');
    const Filter = makeIcon('Fltr');
    const Download = makeIcon('DL');
    const Edit2 = makeIcon('Edt');
    const Save = makeIcon('Sav');
    const LayoutDashboard = makeIcon('Dsh');
    const PieChart = makeIcon('Pie');

    // ====== Reactæœ¬ä½“ ======
    const { useState, useMemo } = React;

    const RealEstateTaskManager = () => {
      const [view, setView] = useState('dashboard');
      const [selectedContract, setSelectedContract] = useState(1);
      const [showNewContract, setShowNewContract] = useState(false);
      const [showEditContract, setShowEditContract] = useState(false);
      const [editingContract, setEditingContract] = useState(null);
      const [editContractTab, setEditContractTab] = useState('basic');
      const [showTaskDetail, setShowTaskDetail] = useState(null);
      const [isEditingTask, setIsEditingTask] = useState(false);
      const [editedTask, setEditedTask] = useState(null);
      const [showPaymentDetail, setShowPaymentDetail] = useState(null);

      const [salesPeriodType, setSalesPeriodType] = useState('month');
      const [salesYear, setSalesYear] = useState(2025);
      const [salesMonth, setSalesMonth] = useState(10);

      const [currentStep, setCurrentStep] = useState(1);
      const [editStep, setEditStep] = useState(1);
      const totalSteps = 7;

      const [searchQuery, setSearchQuery] = useState('');
      const [priorityFilter, setPriorityFilter] = useState('all');
      const [typeFilter, setTypeFilter] = useState('all');
      const [statusFilter, setStatusFilter] = useState('all');
      const [dateFilter, setDateFilter] = useState('all');
      const [showFilters, setShowFilters] = useState(false);
      const [officeFilter, setOfficeFilter] = useState('all');

      // ğŸ”§ è¿½åŠ ï¼šãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºç”¨ stateï¼ˆæœªå®šç¾©ã‚¨ãƒ©ãƒ¼ã®åŸå› ï¼‰
      const [showAddOffice, setShowAddOffice] = useState(false);
      const [showAddStaff, setShowAddStaff] = useState(false);

      const [newContract, setNewContract] = useState({
        propertyType: 'ãƒãƒ³ã‚·ãƒ§ãƒ³', address: '', propertyName: '', roomNumber: '',
        dealType: 'ä»²ä»‹', buyerName: '', buyerKana: '', sellerName: '', sellerKana: '',
        propertyPrice: '', outstandingDebt: '', consumptionTax: '', loanUsage: false,
        loanApprovalDate: '', mortgageRemoval: false, arrears: false, demolition: false,
        renovation: false, survey: false, contractDate: '', settlementDeadline: '',
        confirmedSettlementDate: '', officeId: '', assigneeId: '',
        manualRevenue: '',
        buyerPaymentEnabled: false, buyerPaymentSplit: false,
        buyerPayments: [{ category: 'ä»²ä»‹æ‰‹æ•°æ–™', amount: '', dueDate: '', method: 'æŒ¯è¾¼', receipt: 'éƒµé€' }],
        sellerPaymentEnabled: false, sellerPaymentSplit: false,
        sellerPayments: [{ category: 'ä»²ä»‹æ‰‹æ•°æ–™', amount: '', dueDate: '', method: 'æŒ¯è¾¼', receipt: 'éƒµé€' }],
        vendor1PaymentEnabled: false,
        vendor1Payments: [{ category: 'ç´¹ä»‹æ–™', amount: '', dueDate: '', method: 'æŒ¯è¾¼', receipt: 'éƒµé€' }],
        vendor2PaymentEnabled: false,
        vendor2Payments: [{ category: 'ç´¹ä»‹æ–™', amount: '', dueDate: '', method: 'æŒ¯è¾¼', receipt: 'éƒµé€' }],
        vendor3PaymentEnabled: false,
        vendor3Payments: [{ category: 'ç´¹ä»‹æ–™', amount: '', dueDate: '', method: 'æŒ¯è¾¼', receipt: 'éƒµé€' }],
        buyerExpenseEnabled: false,
        buyerExpenses: [{ category: 'è¿”é‡‘', amount: '', dueDate: '', accountImages: [] }],
        sellerExpenseEnabled: false,
        sellerExpenses: [{ category: 'æ‰‹ä»˜é‡‘', amount: '', dueDate: '', accountImages: [] }],
        vendor1ExpenseEnabled: false,
        vendor1Expenses: [{ category: 'ä»²ä»‹æ‰‹æ•°æ–™', amount: '', dueDate: '', accountImages: [] }],
        vendor2ExpenseEnabled: false,
        vendor2Expenses: [{ category: 'ä»²ä»‹æ‰‹æ•°æ–™', amount: '', dueDate: '', accountImages: [] }],
        vendor3ExpenseEnabled: false,
        vendor3Expenses: [{ category: 'ä»²ä»‹æ‰‹æ•°æ–™', amount: '', dueDate: '', accountImages: [] }]
      });

      const [contracts, setContracts] = useState([
        {
          id: 1, propertyType: 'ãƒãƒ³ã‚·ãƒ§ãƒ³', address: 'æ±äº¬éƒ½æ¸‹è°·åŒºç¥å®®å‰1-1-1',
          propertyName: 'ãƒ‘ãƒ¼ã‚¯ãƒãƒ³ã‚·ãƒ§ãƒ³æ¸‹è°·', roomNumber: '305', dealType: 'ä»²ä»‹',
          buyerName: 'ç”°ä¸­å¤ªéƒ', buyerKana: 'ã‚¿ãƒŠã‚«ã‚¿ãƒ­ã‚¦', sellerName: 'å±±ç”°æ¬¡éƒ',
          sellerKana: 'ãƒ¤ãƒãƒ€ã‚¸ãƒ­ã‚¦', propertyPrice: 50000000, outstandingDebt: 30000000,
          consumptionTax: 0, manualRevenue: 0, loanUsage: true, loanApprovalDate: '2025-11-10',
          mortgageRemoval: true, arrears: false, demolition: false, renovation: true,
          survey: false, contractDate: '2025-10-15', settlementDeadline: '2025-11-30',
          confirmedSettlementDate: '', assigneeId: 1, officeId: 1, status: 'å¥‘ç´„æº–å‚™ä¸­', progress: 30,
          buyerPayments: [], sellerPayments: [], vendor1Payments: [], vendor2Payments: [], vendor3Payments: [],
          buyerExpenses: [], sellerExpenses: [], vendor1Expenses: [], vendor2Expenses: [], vendor3Expenses: []
        }
      ]);

      const [tasks, setTasks] = useState([
        { id: 1, contractId: 1, type: 'å…¥é‡‘', title: 'è²·ä¸»ã‹ã‚‰ä»²ä»‹æ‰‹æ•°æ–™å…¥é‡‘', amount: 1500000, purpose: 'ä»²ä»‹æ‰‹æ•°æ–™', paymentMethod: 'æŒ¯è¾¼', receiptDelivery: 'éƒµé€', dueDate: '2025-11-30', status: 'pending', assigneeId: 1, priority: 'high', paymentCompleted: false },
        { id: 2, contractId: 1, type: 'æŠµå½“æ¨©æŠ¹æ¶ˆ', title: 'æŠµå½“æ¨©æŠ¹æ¶ˆäº‹å‰æ‰‹ç¶šã', dueDate: '2025-10-30', status: 'in-progress', assigneeId: 1, priority: 'high', paymentCompleted: false },
        { id: 3, contractId: 1, type: 'è²·ä¸»èè³‡ç®¡ç†', title: 'èè³‡æ‰¿èªæ‰‹ç¶šã', dueDate: '2025-11-09', status: 'pending', assigneeId: 1, priority: 'high', paymentCompleted: false },
        { id: 4, contractId: 1, type: 'ãƒªãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†', title: 'ãƒªãƒ•ã‚©ãƒ¼ãƒ æ‰‹é…', dueDate: '2025-10-30', status: 'pending', assigneeId: 1, priority: 'medium', paymentCompleted: false },
        { id: 5, contractId: 1, type: 'åå…¥å°ç´™æ‰‹é…', title: 'è²·ä¸» åå…¥å°ç´™æ‰‹é…', stampAmount: 20000, dueDate: '2025-11-28', status: 'done', assigneeId: 1, priority: 'high', party: 'è²·ä¸»', paymentCompleted: false },
        { id: 6, contractId: 1, type: 'åå…¥å°ç´™æ‰‹é…', title: 'å£²ä¸» åå…¥å°ç´™æ‰‹é…', stampAmount: 20000, dueDate: '2025-11-28', status: 'pending', assigneeId: 1, priority: 'high', party: 'å£²ä¸»', paymentCompleted: false }
      ]);

      // ==== å–¶æ¥­æ‰€ãƒ»ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†ï¼ˆç´ã¥ã‘å¯¾å¿œï¼‰ ====
      const [offices, setOffices] = useState([
        {
          id: 1,
          name: 'æ¸‹è°·å–¶æ¥­æ‰€',
          address: 'æ±äº¬éƒ½æ¸‹è°·åŒº',
          staff: [
            { id: 1, name: 'å±±ç”°èŠ±å­', role: 'å–¶æ¥­æ‹…å½“' },
            { id: 2, name: 'éˆ´æœ¨ä¸€éƒ', role: 'å–¶æ¥­æ‹…å½“' }
          ]
        },
        {
          id: 2,
          name: 'æ–°å®¿å–¶æ¥­æ‰€',
          address: 'æ±äº¬éƒ½æ–°å®¿åŒº',
          staff: [
            { id: 3, name: 'ç”°ä¸­æ¬¡éƒ', role: 'æ‰€é•·' },
            { id: 4, name: 'ä½è—¤ç¾å’²', role: 'çµŒç†' }
          ]
        }
      ]);

      const [newOffice, setNewOffice] = useState({ name: '', address: '' });
      const [newStaff, setNewStaff] = useState({ name: '', role: 'å–¶æ¥­æ‹…å½“', officeId: null });

      // å–¶æ¥­æ‰€è¿½åŠ 
      const addOffice = () => {
        if (!newOffice.name.trim() || !newOffice.address.trim()) return;
        const newId = offices.length ? Math.max(...offices.map(o => o.id)) + 1 : 1;
        setOffices([...offices, { id: newId, ...newOffice, staff: [] }]);
        setNewOffice({ name: '', address: '' });
      };

      // å–¶æ¥­æ‰€å‰Šé™¤
      const removeOffice = (id) => {
        if (confirm('ã“ã®å–¶æ¥­æ‰€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
          setOffices(offices.filter(o => o.id !== id));
        }
      };

      // ã‚¹ã‚¿ãƒƒãƒ•è¿½åŠ ï¼ˆå–¶æ¥­æ‰€ã«ç´ã¥ã‘ï¼‰
      const addStaff = () => {
        if (!newStaff.name.trim() || !newStaff.officeId) return;
        const updatedOffices = offices.map(o => {
          if (o.id === parseInt(newStaff.officeId)) {
            const newId = o.staff.length > 0 ? Math.max(...o.staff.map(s => s.id)) + 1 : 1;
            return { ...o, staff: [...o.staff, { id: newId, name: newStaff.name, role: newStaff.role }] };
          }
          return o;
        });
        setOffices(updatedOffices);
        setNewStaff({ name: '', role: 'å–¶æ¥­æ‹…å½“', officeId: null });
      };

      // ã‚¹ã‚¿ãƒƒãƒ•å‰Šé™¤
      const removeStaff = (officeId, staffId) => {
        const updatedOffices = offices.map(o => {
          if (o.id === officeId) {
            return { ...o, staff: o.staff.filter(s => s.id !== staffId) };
          }
          return o;
        });
        setOffices(updatedOffices);
      };

      const propertyTypes = ['ãƒãƒ³ã‚·ãƒ§ãƒ³', 'åœŸåœ°', 'æˆ¸å»ºã¦', 'åç›Šç‰©ä»¶', 'äº‹æ¥­ç”¨ç‰©ä»¶'];
      const dealTypes = ['è²·å–å†è²©', 'ä»²ä»‹'];

      const updateTaskStatus = (taskId, newStatus) => {
        setTasks(prev => prev.map(t => (t.id === taskId ? { ...t, status: newStatus } : t)));
      };

      const handlePaymentComplete = (taskId, taskType) => {
        setTasks(prev => prev.map(t =>
          t.id === taskId ? { ...t, paymentCompleted: true, status: 'done' } : t
        ));
        setShowPaymentDetail(null);
        alert(`${taskType}ãŒå®Œäº†ã—ã¾ã—ãŸï¼å£²ä¸Šã«åæ˜ ã•ã‚Œã¾ã—ãŸã€‚`);
      };

      const isToday = (dateStr) => {
        const today = new Date('2025-10-21');
        const date = new Date(dateStr);
        return date.toDateString() === today.toDateString();
      };

      const filteredTasks = useMemo(() => {
        let filtered = tasks.filter(t => t.contractId === selectedContract);
        if (searchQuery) {
          filtered = filtered.filter(t =>
            t.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
            t.type.toLowerCase().includes(searchQuery.toLowerCase())
          );
        }
        return filtered;
      }, [tasks, selectedContract, searchQuery]);

      const filteredContracts = useMemo(() => {
        if (officeFilter === 'all') return contracts;
        return contracts.filter(c => c.officeId === parseInt(officeFilter));
      }, [contracts, officeFilter]);

      const dashboardStats = useMemo(() => {
        return {
          totalContracts: contracts.length,
          activeContracts: contracts.filter(c => c.progress < 100).length,
          totalTasks: tasks.length,
          pendingTasks: tasks.filter(t => t.status === 'pending').length,
          inProgressTasks: tasks.filter(t => t.status === 'in-progress').length,
          completedTasks: tasks.filter(t => t.status === 'done').length,
          todayTasks: tasks.filter(t => isToday(t.dueDate)).length,
          highPriorityTasks: tasks.filter(t => t.priority === 'high' && t.status !== 'done').length,
          completionRate: tasks.length > 0 ? Math.round((tasks.filter(t => t.status === 'done').length / tasks.length) * 100) : 0,
          totalRevenue: contracts.reduce((sum, c) => sum + (c.propertyPrice * 0.03), 0)
        };
      }, [contracts, tasks]);

      const salesStats = useMemo(() => {
        let startDate, endDate;
        if (salesPeriodType === 'month') {
          startDate = new Date(salesYear, salesMonth - 1, 1);
          endDate = new Date(salesYear, salesMonth, 0);
        } else {
          startDate = new Date(salesYear, salesMonth - 2, 21);
          endDate = new Date(salesYear, salesMonth - 1, 20);
        }

        const startDateStr = startDate.toISOString().split('T')[0];
        const endDateStr = endDate.toISOString().split('T')[0];
        const statsByOffice = {};

        offices.forEach(office => {
          const officeTasks = tasks.filter(t => {
            const contract = contracts.find(c => c.id === t.contractId);
            return contract && contract.officeId === office.id && t.type === 'å…¥é‡‘' && t.amount &&
                   t.dueDate >= startDateStr && t.dueDate <= endDateStr;
          });

          const completedAmount = officeTasks.filter(t => t.paymentCompleted).reduce((sum, t) => sum + (t.amount || 0), 0);
          const pendingAmount = officeTasks.filter(t => !t.paymentCompleted).reduce((sum, t) => sum + (t.amount || 0), 0);

          const officeContracts = contracts.filter(c =>
            c.officeId === office.id &&
            c.dealType === 'è²·å–å†è²©' &&
            c.contractDate >= startDateStr &&
            c.contractDate <= endDateStr
          );
          const manualRevenueTotal = officeContracts.reduce((sum, c) => sum + (c.manualRevenue || 0), 0);

          statsByOffice[office.id] = {
            officeName: office.name,
            completed: completedAmount,
            pending: pendingAmount + manualRevenueTotal,
            total: completedAmount + pendingAmount + manualRevenueTotal
          };
        });

        const totalCompleted = Object.values(statsByOffice).reduce((sum, s) => sum + s.completed, 0);
        const totalPending = Object.values(statsByOffice).reduce((sum, s) => sum + s.pending, 0);

        return {
          byOffice: statsByOffice,
          totalCompleted,
          totalPending,
          total: totalCompleted + totalPending,
          periodStart: startDate,
          periodEnd: endDate
        };
      }, [tasks, contracts, offices, salesPeriodType, salesYear, salesMonth]);

      const handleAddOffice = () => {
        if (newOffice.name && newOffice.address) {
          setOffices([...offices, { id: offices.length + 1, ...newOffice }]);
          setNewOffice({ name: '', address: '' });
          setShowAddOffice(false);
        }
      };

      // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®è¿½åŠ ã‚¹ã‚¿ãƒƒãƒ•ï¼ˆåˆ¥UIç”¨ï¼‰â€” æ—¢ã«ã‚ã‚‹ addStaff ã¨å½¹å‰²åˆ†æ‹…
      const handleAddStaff = () => {
        if (!newStaff.name || !newStaff.officeId) return;
        setOffices(prev =>
          prev.map(o =>
            o.id === parseInt(newStaff.officeId)
              ? {
                  ...o,
                  staff: [
                    ...o.staff,
                    {
                      id: o.staff.length ? Math.max(...o.staff.map(s => s.id)) + 1 : 1,
                      name: newStaff.name,
                      role: newStaff.role,
                    },
                  ],
                }
              : o
          )
        );
        setNewStaff({ name: '', officeId: '', role: 'å–¶æ¥­æ‹…å½“' });
        setShowAddStaff(false);
      };

      const getTaskIcon = (type) => {
        switch(type) {
          case 'å…¥é‡‘': return DollarSign;
          case 'æ”¯æ‰•ã„': return DollarSign;
          case 'å¥‘ç´„æ›¸ç®¡ç†': return FileText;
          case 'åå…¥å°ç´™æ‰‹é…': return FileText;
          default: return AlertCircle;
        }
      };

      const getPriorityColor = (priority) => {
        switch(priority) {
          case 'high': return 'bg-red-100 text-red-700 border-red-300';
          case 'medium': return 'bg-yellow-100 text-yellow-700 border-yellow-300';
          default: return 'bg-gray-100 text-gray-700 border-gray-300';
        }
      };

      const selectedContractData = contracts.find(c => c.id === selectedContract);
      const tasksByStatus = {
        pending: filteredTasks.filter(t => t.status === 'pending'),
        'in-progress': filteredTasks.filter(t => t.status === 'in-progress'),
        done: filteredTasks.filter(t => t.status === 'done')
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50">
          <header className="bg-white border-b border-gray-200 shadow-sm sticky top-0 z-50">
            <div className="max-w-7xl mx-auto px-4 py-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center space-x-4">
                  <Building2 className="w-8 h-8 text-blue-600" />
                  <h1 className="text-2xl font-bold text-gray-800">ä¸å‹•ç”£å¥‘ç´„é€²æ—ç®¡ç†</h1>
                </div>
                <div className="flex items-center space-x-3">
                  <button onClick={() => setView('dashboard')} className={`px-4 py-2 rounded-lg font-semibold transition-all flex items-center space-x-2 ${view === 'dashboard' ? 'bg-indigo-500 text-white' : 'bg-gray-100 text-gray-700'}`}>
                    <LayoutDashboard className="w-5 h-5" />
                    <span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
                  </button>
                  <button onClick={() => setView('contracts')} className={`px-4 py-2 rounded-lg font-semibold transition-all ${view === 'contracts' ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-700'}`}>å¥‘ç´„ç®¡ç†</button>
                  <button onClick={() => setView('accounting')} className={`px-4 py-2 rounded-lg font-semibold transition-all ${view === 'accounting' ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-700'}`}>çµŒç†ç®¡ç†</button>
                  <button onClick={() => setView('sales')} className={`px-4 py-2 rounded-lg font-semibold transition-all ${view === 'sales' ? 'bg-purple-500 text-white' : 'bg-gray-100 text-gray-700'}`}>å£²ä¸Šç®¡ç†</button>
                  <button onClick={() => setView('office')} className={`px-4 py-2 rounded-lg font-semibold transition-all ${view === 'office' ? 'bg-orange-500 text-white' : 'bg-gray-100 text-gray-700'}`}>
                    <Users className="w-5 h-5 inline mr-1" />å–¶æ¥­æ‰€ç®¡ç†
                  </button>
                </div>
              </div>
            </div>
          </header>

          {view === 'dashboard' && (
            <div className="max-w-7xl mx-auto px-4 py-6">
              <div className="mb-6">
                <h2 className="text-3xl font-bold text-gray-800 mb-2">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
                <p className="text-gray-600">æ¥­å‹™å…¨ä½“ã®æ¦‚è¦ã¨çµ±è¨ˆæƒ…å ±</p>
              </div>

              <div className="grid grid-cols-4 gap-6 mb-6">
                <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white">
                  <div className="flex items-center justify-between mb-4">
                    <Building2 className="w-10 h-10 opacity-80" />
                    <div className="text-3xl font-bold">{dashboardStats.totalContracts}</div>
                  </div>
                  <div className="text-sm opacity-90">ç·å¥‘ç´„æ•°</div>
                  <div className="text-xs opacity-75 mt-1">é€²è¡Œä¸­: {dashboardStats.activeContracts}ä»¶</div>
                </div>

                <div className="bg-gradient-to-br from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white">
                  <div className="flex items-center justify-between mb-4">
                    <Check className="w-10 h-10 opacity-80" />
                    <div className="text-3xl font-bold">{dashboardStats.completedTasks}</div>
                  </div>
                  <div className="text-sm opacity-90">å®Œäº†ã‚¿ã‚¹ã‚¯</div>
                  <div className="text-xs opacity-75 mt-1">å®Œäº†ç‡: {dashboardStats.completionRate}%</div>
                </div>

                <div className="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl shadow-lg p-6 text-white">
                  <div className="flex items-center justify-between mb-4">
                    <Clock className="w-10 h-10 opacity-80" />
                    <div className="text-3xl font-bold">{dashboardStats.inProgressTasks}</div>
                  </div>
                  <div className="text-sm opacity-90">é€²è¡Œä¸­ã‚¿ã‚¹ã‚¯</div>
                  <div className="text-xs opacity-75 mt-1">æœªç€æ‰‹: {dashboardStats.pendingTasks}ä»¶</div>
                </div>

                <div className="bg-gradient-to-br from-red-500 to-red-600 rounded-xl shadow-lg p-6 text-white">
                  <div className="flex items-center justify-between mb-4">
                    <AlertCircle className="w-10 h-10 opacity-80" />
                    <div className="text-3xl font-bold">{dashboardStats.highPriorityTasks}</div>
                  </div>
                  <div className="text-sm opacity-90">é«˜å„ªå…ˆåº¦ã‚¿ã‚¹ã‚¯</div>
                  <div className="text-xs opacity-75 mt-1">æœ¬æ—¥æœŸé™: {dashboardStats.todayTasks}ä»¶</div>
                </div>
              </div>

              <div className="grid grid-cols-3 gap-6 mb-6">
                <div className="col-span-2 bg-white rounded-xl shadow-lg p-6">
                  <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <PieChart className="w-6 h-6 mr-2 text-blue-600" />
                    ã‚¿ã‚¹ã‚¯é€²æ—çŠ¶æ³
                  </h3>
                  <div className="space-y-4">
                    <div>
                      <div className="flex items-center justify-between mb-2">
                        <span className="text-sm font-semibold text-gray-700">æœªç€æ‰‹</span>
                        <span className="text-sm font-bold text-gray-800">{dashboardStats.pendingTasks}ä»¶</span>
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-3">
                        <div className="bg-gray-500 h-3 rounded-full" style={{ width: `${(dashboardStats.pendingTasks / dashboardStats.totalTasks) * 100}%` }}></div>
                      </div>
                    </div>
                    <div>
                      <div className="flex items-center justify-between mb-2">
                        <span className="text-sm font-semibold text-gray-700">é€²è¡Œä¸­</span>
                        <span className="text-sm font-bold text-gray-800">{dashboardStats.inProgressTasks}ä»¶</span>
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-3">
                        <div className="bg-blue-500 h-3 rounded-full" style={{ width: `${(dashboardStats.inProgressTasks / dashboardStats.totalTasks) * 100}%` }}></div>
                      </div>
                    </div>
                    <div>
                      <div className="flex items-center justify-between mb-2">
                        <span className="text-sm font-semibold text-gray-700">å®Œäº†</span>
                        <span className="text-sm font-bold text-gray-800">{dashboardStats.completedTasks}ä»¶</span>
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-3">
                        <div className="bg-green-500 h-3 rounded-full" style={{ width: `${(dashboardStats.completedTasks / dashboardStats.totalTasks) * 100}%` }}></div>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-xl shadow-lg p-6">
                  <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <TrendingUp className="w-6 h-6 mr-2 text-purple-600" />
                    å£²ä¸Šã‚µãƒãƒªãƒ¼
                  </h3>
                  <div className="space-y-4">
                    <div className="border-b border-gray-200 pb-4">
                      <div className="text-sm text-gray-600 mb-1">ç·å£²ä¸Šè¦‹è¾¼</div>
                      <div className="text-2xl font-bold text-purple-600">
                        Â¥{Math.round(dashboardStats.totalRevenue).toLocaleString()}
                      </div>
                    </div>
                    <div className="border-b border-gray-200 pb-4">
                      <div className="text-sm text-gray-600 mb-1">å¥‘ç´„å˜ä¾¡å¹³å‡</div>
                      <div className="text-xl font-bold text-gray-800">
                        Â¥{Math.round(dashboardStats.totalRevenue / dashboardStats.totalContracts).toLocaleString()}
                      </div>
                    </div>
                    <div>
                      <div className="text-sm text-gray-600 mb-1">å–¶æ¥­æ‰€æ•°</div>
                      <div className="text-xl font-bold text-gray-800">{offices.length}æ‹ ç‚¹</div>
                    </div>
                  </div>
                </div>
              </div>

              <div className="grid grid-cols-2 gap-6">
                <div className="bg-white rounded-xl shadow-lg p-6">
                  <h3 className="text-xl font-bold text-gray-800 mb-4">æœ¬æ—¥æœŸé™ã®ã‚¿ã‚¹ã‚¯</h3>
                  <div className="space-y-3">
                    {tasks.filter(t => isToday(t.dueDate) && t.status !== 'done').length === 0 ? (
                      <div className="text-center py-8 text-gray-500">æœ¬æ—¥æœŸé™ã®ã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“</div>
                    ) : (
                      tasks.filter(t => isToday(t.dueDate) && t.status !== 'done').map(task => (
                        <div key={task.id} className="border-l-4 border-red-500 bg-red-50 p-4 rounded">
                          <div className="font-semibold text-gray-800">{task.title}</div>
                          <div className="text-sm text-gray-600 mt-1">{task.type}</div>
                        </div>
                      ))
                    )}
                  </div>
                </div>

                <div className="bg-white rounded-xl shadow-lg p-6">
                  <h3 className="text-xl font-bold text-gray-800 mb-4">é«˜å„ªå…ˆåº¦ã‚¿ã‚¹ã‚¯</h3>
                  <div className="space-y-3">
                    {tasks.filter(t => t.priority === 'high' && t.status !== 'done').slice(0, 5).map(task => (
                      <div key={task.id} className="border-l-4 border-orange-500 bg-orange-50 p-4 rounded">
                        <div className="font-semibold text-gray-800">{task.title}</div>
                        <div className="text-sm text-gray-600 mt-1">æœŸæ—¥: {task.dueDate}</div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          )}

          {view === 'contracts' && (
            <div className="max-w-7xl mx-auto px-4 py-6">
              <div className="flex items-center justify-between mb-6">
                <h2 className="text-2xl font-bold text-gray-800">å¥‘ç´„ç®¡ç† - ç‰©ä»¶åˆ¥ã‚¿ã‚¹ã‚¯ä¸€è¦§</h2>
                <div className="flex items-center space-x-4">
                  <select value={officeFilter} onChange={(e) => setOfficeFilter(e.target.value)} className="px-4 py-2 border border-gray-300 rounded-lg">
                    <option value="all">ã™ã¹ã¦ã®å–¶æ¥­æ‰€</option>
                    {offices.map(office => (
                      <option key={office.id} value={office.id}>{office.name}</option>
                    ))}
                  </select>
                  <div className="relative">
                    <Search className="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" />
                    <input type="text" placeholder="ã‚¿ã‚¹ã‚¯ã‚’æ¤œç´¢..." value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} className="pl-10 pr-4 py-2 border border-gray-300 rounded-lg" />
                  </div>
                </div>
              </div>

              <div className="space-y-6">
                {filteredContracts.map(contract => {
                  const contractTasks = tasks.filter(t => t.contractId === contract.id);
                  const pendingTasks = contractTasks.filter(t => t.status === 'pending');
                  const inProgressTasks = contractTasks.filter(t => t.status === 'in-progress');
                  const doneTasks = contractTasks.filter(t => t.status === 'done');

                  return (
                    <div key={contract.id} className="bg-white rounded-xl shadow-lg overflow-hidden">
                      {/* ç‰©ä»¶ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                      <div className="bg-gradient-to-r from-blue-500 to-purple-500 p-6 text-white">
                        <div className="flex items-start justify-between">
                          <div className="flex-1">
                            <h3 className="text-xl font-bold mb-2">
                              {contract.propertyType} - {contract.propertyType === 'ãƒãƒ³ã‚·ãƒ§ãƒ³' ? `${contract.propertyName} ${contract.roomNumber}` : contract.address}
                            </h3>
                            <div className="grid grid-cols-2 gap-x-6 gap-y-1 text-sm opacity-90">
                              <span>è²·ä¸»: {contract.buyerName}</span>
                              <span>å£²ä¸»: {contract.sellerName}</span>
                              <span>ç‰©ä»¶é‡‘é¡: Â¥{contract.propertyPrice.toLocaleString()}</span>
                              <span>å¥‘ç´„æ—¥: {contract.contractDate}</span>
                              <span>å–¶æ¥­æ‰€ID: {contract.officeId}</span>
                              <span>æ‹…å½“ID: {contract.assigneeId}</span>
                            </div>
                          </div>
                          <div className="ml-6">
                            <div className="bg-white bg-opacity-20 rounded-lg px-4 py-2 text-center">
                              <div className="text-xs opacity-90">é€²æ—</div>
                              <div className="text-2xl font-bold">{contract.progress}%</div>
                            </div>
                          </div>
                        </div>
                      </div>

                      {/* ã‚¿ã‚¹ã‚¯ä¸€è¦§ */}
                      <div className="p-6">
                        <div className="grid grid-cols-3 gap-4">
                          {/* æœªç€æ‰‹ */}
                          <div className="bg-gray-50 rounded-lg p-4">
                            <div className="flex items-center justify-between mb-3">
                              <h4 className="font-semibold text-gray-800 flex items-center">
                                <AlertCircle className="w-4 h-4 mr-2" />
                                æœªç€æ‰‹
                              </h4>
                              <span className="bg-white px-2 py-1 rounded-full text-xs font-bold text-gray-600">
                                {pendingTasks.length}
                              </span>
                            </div>
                            <div className="space-y-2">
                              {pendingTasks.map(task => {
                                const TaskIcon = getTaskIcon(task.type);
                                return (
                                  <div key={task.id} onClick={() => setShowTaskDetail(task)} className="bg-white rounded-lg p-3 shadow-sm hover:shadow-md transition-all cursor-pointer">
                                    <div className="flex items-start justify-between mb-1">
                                      <div className="flex items-center space-x-2 flex-1">
                                        <TaskIcon className="w-3 h-3 text-blue-600" />
                                        <span className="font-semibold text-xs text-gray-800">{task.title}</span>
                                      </div>
                                      <span className={`text-xs px-1.5 py-0.5 rounded-full border ${getPriorityColor(task.priority)}`}>
                                        {task.priority === 'high' ? 'é«˜' : 'ä¸­'}
                                      </span>
                                    </div>
                                    <div className="text-xs text-gray-500 mb-1">{task.type}</div>
                                    <div className="flex items-center justify-between text-xs text-gray-600">
                                      <span className="flex items-center">
                                        <Calendar className="w-3 h-3 mr-1" />
                                        {task.dueDate}
                                      </span>
                                      {task.amount && (
                                        <span className="font-semibold text-green-600">Â¥{task.amount.toLocaleString()}</span>
                                      )}
                                    </div>
                                  </div>
                                );
                              })}
                              {pendingTasks.length === 0 && (
                                <div className="text-center text-xs text-gray-400 py-4">ã‚¿ã‚¹ã‚¯ãªã—</div>
                              )}
                            </div>
                          </div>

                          {/* é€²è¡Œä¸­ */}
                          <div className="bg-blue-50 rounded-lg p-4">
                            <div className="flex items-center justify-between mb-3">
                              <h4 className="font-semibold text-gray-800 flex items-center">
                                <Clock className="w-4 h-4 mr-2" />
                                é€²è¡Œä¸­
                              </h4>
                              <span className="bg-white px-2 py-1 rounded-full text-xs font-bold text-gray-600">
                                {inProgressTasks.length}
                              </span>
                            </div>
                            <div className="space-y-2">
                              {inProgressTasks.map(task => {
                                const TaskIcon = getTaskIcon(task.type);
                                return (
                                  <div key={task.id} onClick={() => setShowTaskDetail(task)} className="bg-white rounded-lg p-3 shadow-sm hover:shadow-md transition-all cursor-pointer">
                                    <div className="flex items-start justify-between mb-1">
                                      <div className="flex items-center space-x-2 flex-1">
                                        <TaskIcon className="w-3 h-3 text-blue-600" />
                                        <span className="font-semibold text-xs text-gray-800">{task.title}</span>
                                      </div>
                                      <span className={`text-xs px-1.5 py-0.5 rounded-full border ${getPriorityColor(task.priority)}`}>
                                        {task.priority === 'high' ? 'é«˜' : 'ä¸­'}
                                      </span>
                                    </div>
                                    <div className="text-xs text-gray-500 mb-1">{task.type}</div>
                                    <div className="flex items-center justify-between text-xs text-gray-600">
                                      <span className="flex items-center">
                                        <Calendar className="w-3 h-3 mr-1" />
                                        {task.dueDate}
                                      </span>
                                      {task.amount && (
                                        <span className="font-semibold text-green-600">Â¥{task.amount.toLocaleString()}</span>
                                      )}
                                    </div>
                                  </div>
                                );
                              })}
                              {inProgressTasks.length === 0 && (
                                <div className="text-center text-xs text-gray-400 py-4">ã‚¿ã‚¹ã‚¯ãªã—</div>
                              )}
                            </div>
                          </div>

                          {/* å®Œäº† */}
                          <div className="bg-green-50 rounded-lg p-4">
                            <div className="flex items-center justify-between mb-3">
                              <h4 className="font-semibold text-gray-800 flex items-center">
                                <Check className="w-4 h-4 mr-2" />
                                å®Œäº†
                              </h4>
                              <span className="bg-white px-2 py-1 rounded-full text-xs font-bold text-gray-600">
                                {doneTasks.length}
                              </span>
                            </div>
                            <div className="space-y-2">
                              {doneTasks.map(task => {
                                const TaskIcon = getTaskIcon(task.type);
                                return (
                                  <div key={task.id} onClick={() => setShowTaskDetail(task)} className="bg-white rounded-lg p-3 shadow-sm hover:shadow-md transition-all cursor-pointer">
                                    <div className="flex items-start justify-between mb-1">
                                      <div className="flex items-center space-x-2 flex-1">
                                        <TaskIcon className="w-3 h-3 text-blue-600" />
                                        <span className="font-semibold text-xs text-gray-800">{task.title}</span>
                                      </div>
                                      <span className={`text-xs px-1.5 py-0.5 rounded-full border ${getPriorityColor(task.priority)}`}>
                                        {task.priority === 'high' ? 'é«˜' : 'ä¸­'}
                                      </span>
                                    </div>
                                    <div className="text-xs text-gray-500 mb-1">{task.type}</div>
                                    <div className="flex items-center justify-between text-xs text-gray-600">
                                      <span className="flex items-center">
                                        <Calendar className="w-3 h-3 mr-1" />
                                        {task.dueDate}
                                      </span>
                                      {task.amount && (
                                        <span className="font-semibold text-green-600">Â¥{task.amount.toLocaleString()}</span>
                                      )}
                                    </div>
                                  </div>
                                );
                              })}
                              {doneTasks.length === 0 && (
                                <div className="text-center text-xs text-gray-400 py-4">ã‚¿ã‚¹ã‚¯ãªã—</div>
                              )}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          )}

          {view === 'accounting' && (
            <div className="max-w-7xl mx-auto px-4 py-6">
              <h2 className="text-2xl font-bold text-gray-800 mb-6">çµŒç†ç®¡ç†</h2>

              {/* å…¥é‡‘ç®¡ç† */}
              <div className="mb-8">
                <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
                  <DollarSign className="w-6 h-6 mr-2 text-green-600" />
                  å…¥é‡‘ç®¡ç†
                </h3>
                <div className="grid grid-cols-2 gap-6">
                  {/* æœ¬æ—¥åˆ† */}
                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <h4 className="text-lg font-semibold text-gray-800 mb-4">æœ¬æ—¥ã®å…¥é‡‘äºˆå®š</h4>
                    {tasks.filter(t => t.type === 'å…¥é‡‘' && isToday(t.dueDate) && !t.paymentCompleted).length === 0 ? (
                      <div className="text-sm text-gray-500 text-center py-8">æœ¬æ—¥ã®å…¥é‡‘äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“</div>
                    ) : (
                      <div className="space-y-3">
                        {tasks.filter(t => t.type === 'å…¥é‡‘' && isToday(t.dueDate) && !t.paymentCompleted).map(task => {
                          const contract = contracts.find(c => c.id === task.contractId);
                          return (
                            <div
                              key={task.id}
                              onClick={() => setShowPaymentDetail(task)}
                              className="border-l-4 border-green-500 bg-green-50 p-4 rounded cursor-pointer hover:shadow-md transition-all"
                            >
                              <div className="font-semibold text-gray-800">{task.title}</div>
                              <div className="text-sm text-gray-600 mt-1">é‡‘é¡: Â¥{task.amount?.toLocaleString()}</div>
                              <div className="text-xs text-gray-500 mt-1">ç‰©ä»¶: {contract?.propertyType}</div>
                            </div>
                          );
                        })}
                      </div>
                    )}
                  </div>

                  {/* 7æ—¥å¾Œã¾ã§ */}
                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <h4 className="text-lg font-semibold text-gray-800 mb-4">å…¥é‡‘äºˆå®šï¼ˆ7æ—¥å¾Œã¾ã§ï¼‰</h4>
                    {tasks.filter(t => t.type === 'å…¥é‡‘' && !t.paymentCompleted).length === 0 ? (
                      <div className="text-sm text-gray-500 text-center py-8">å…¥é‡‘äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“</div>
                    ) : (
                      <div className="space-y-3 max-h-96 overflow-y-auto">
                        {tasks.filter(t => t.type === 'å…¥é‡‘' && !t.paymentCompleted).map(task => {
                          const contract = contracts.find(c => c.id === task.contractId);
                          return (
                            <div
                              key={task.id}
                              onClick={() => setShowPaymentDetail(task)}
                              className="border-l-4 border-green-400 bg-green-50 p-4 rounded cursor-pointer hover:bg-green-100 transition-colors"
                            >
                              <div className="font-semibold text-gray-800">{task.title}</div>
                              <div className="text-sm text-gray-600 mt-1">é‡‘é¡: Â¥{task.amount?.toLocaleString()}</div>
                              <div className="text-xs text-gray-500 mt-1">æœŸæ—¥: {task.dueDate}</div>
                              <div className="text-xs text-gray-500">ç‰©ä»¶: {contract?.propertyType}</div>
                            </div>
                          );
                        })}
                      </div>
                    )}
                  </div>
                </div>
              </div>

              {/* æ”¯æ‰•ç®¡ç† */}
              <div>
                <h3 className="text-xl font-bold text-gray-800 mb-4 flex itemsã‚»ãƒ³ã‚¿ãƒ¼">
                  <DollarSign className="w-6 h-6 mr-2 text-red-600" />
                  æ”¯æ‰•ç®¡ç†
                </h3>
                <div className="grid grid-cols-2 gap-6">
                  {/* æœ¬æ—¥åˆ† */}
                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <h4 className="text-lg font-semibold text-gray-800 mb-4">æœ¬æ—¥ã®æ”¯æ‰•äºˆå®š</h4>
                    {tasks.filter(t => t.type === 'æ”¯æ‰•ã„' && isToday(t.dueDate) && !t.paymentCompleted).length === 0 ? (
                      <div className="text-sm text-gray-500 text-center py-8">æœ¬æ—¥ã®æ”¯æ‰•äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“</div>
                    ) : (
                      <div className="space-y-3">
                        {tasks.filter(t => t.type === 'æ”¯æ‰•ã„' && isToday(t.dueDate) && !t.paymentCompleted).map(task => {
                          const contract = contracts.find(c => c.id === task.contractId);
                          return (
                            <div
                              key={task.id}
                              onClick={() => setShowPaymentDetail(task)}
                              className="border-l-4 border-red-500 bg-red-50 p-4 rounded cursor-pointer hover:shadow-md transition-all"
                            >
                              <div className="font-semibold text-gray-800">{task.title}</div>
                              <div className="text-sm text-gray-600 mt-1">é‡‘é¡: Â¥{task.amount?.toLocaleString()}</div>
                              <div className="text-xs text-gray-500 mt-1">ç‰©ä»¶: {contract?.propertyType}</div>
                            </div>
                          );
                        })}
                      </div>
                    )}
                  </div>

                  {/* 7æ—¥å¾Œã¾ã§ */}
                  <div className="bg-white rounded-xl shadow-lg p-6">
                    <h4 className="text-lg font-semibold text-gray-800 mb-4">æ”¯æ‰•äºˆå®šï¼ˆ7æ—¥å¾Œã¾ã§ï¼‰</h4>
                    {tasks.filter(t => t.type === 'æ”¯æ‰•ã„' && !t.paymentCompleted).length === 0 ? (
                      <div className="text-sm text-gray-500 text-center py-8">æ”¯æ‰•äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“</div>
                    ) : (
                      <div className="space-y-3 max-h-96 overflow-y-auto">
                        {tasks.filter(t => t.type === 'æ”¯æ‰•ã„' && !t.paymentCompleted).map(task => {
                          const contract = contracts.find(c => c.id === task.contractId);
                          return (
                            <div
                              key={task.id}
                              onClick={() => setShowPaymentDetail(task)}
                              className="border-l-4 border-red-400 bg-red-50 p-4 rounded cursor-pointer hover:bg-red-100 transition-colors"
                            >
                              <div className="font-semibold text-gray-800">{task.title}</div>
                              <div className="text-sm text-gray-600 mt-1">é‡‘é¡: Â¥{task.amount?.toLocaleString()}</div>
                              <div className="text-xs text-gray-500 mt-1">æœŸæ—¥: {task.dueDate}</div>
                              <div className="text-xs text-gray-500">ç‰©ä»¶: {contract?.propertyType}</div>
                            </div>
                          );
                        })}
                      </div>
                    )}
                  </div>
                </div>
              </div>
            </div>
          )}

          {view === 'sales' && (
            <div className="max-w-7xl mx-auto px-4 py-6">
              <h2 className="text-2xl font-bold text-gray-800 mb-6">å£²ä¸Šç®¡ç†</h2>

              <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div className="flex items-center justify-between">
                  <div className="flex items-center space-x-4">
                    <h3 className="text-lg font-bold text-gray-800">è¡¨ç¤ºæœŸé–“</h3>
                    <div className="flex items-center space-x-2">
                      <button onClick={() => setSalesPeriodType('month')} className={`px-4 py-2 rounded-lg font-semibold ${salesPeriodType === 'month' ? 'bg-purple-500 text-white' : 'bg-gray-100 text-gray-700'}`}>æœˆåˆï½æœˆæœ«</button>
                      <button onClick={() => setSalesPeriodType('21st')} className={`px-4 py-2 rounded-lg font-semibold ${salesPeriodType === '21st' ? 'bg-purple-500 text-white' : 'bg-gray-100 text-gray-700'}`}>21æ—¥ï½20æ—¥</button>
                    </div>
                  </div>
                  <div className="text-center">
                    <div className="text-2xl font-bold text-gray-800">{salesYear}å¹´ {salesMonth}æœˆ</div>
                  </div>
                </div>
              </div>

              <div className="grid grid-cols-3 gap-6 mb-6">
                <div className="bg-gradient-to-br from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white">
                  <div className="text-sm opacity-90 mb-2">å…¥é‡‘æ¸ˆã¿åˆ†</div>
                  <div className="text-3xl font-bold">Â¥{salesStats.totalCompleted.toLocaleString()}</div>
                </div>
                <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white">
                  <div className="text-sm opacity-90 mb-2">å…¥é‡‘äºˆå®šåˆ†</div>
                  <div className="text-3xl font-bold">Â¥{salesStats.totalPending.toLocaleString()}</div>
                </div>
                <div className="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow-lg p-6 text-white">
                  <div className="text-sm opacity-90 mb-2">åˆè¨ˆ</div>
                  <div className="text-3xl font-bold">Â¥{salesStats.total.toLocaleString()}</div>
                </div>
              </div>

              <div className="bg-white rounded-xl shadow-lg p-6">
                <h3 className="text-2xl font-bold text-gray-800 mb-6">å–¶æ¥­æ‰€åˆ¥å£²ä¸Š</h3>
                <div className="grid grid-cols-3 gap-6">
                  {offices.map(office => {
                    const stats = salesStats.byOffice[office.id] || { completed: 0, pending: 0, total: 0 };
                    return (
                      <div key={office.id} className="border-2 border-purple-200 rounded-xl p-5">
                        <h4 className="text-lg font-bold text-gray-800 mb-4">{office.name}</h4>
                        <div className="space-y-3">
                          <div className="bg-green-50 p-3 rounded-lg">
                            <div className="text-xs text-gray-600 mb-1">å…¥é‡‘æ¸ˆã¿</div>
                            <div className="text-2xl font-bold text-green-600">Â¥{stats.completed.toLocaleString()}</div>
                          </div>
                          <div className="bg-blue-50 p-3 rounded-lg">
                            <div className="text-xs text-gray-600 mb-1">äºˆå®šåˆ†</div>
                            <div className="text-2xl font-bold text-blue-600">Â¥{stats.pending.toLocaleString()}</div>
                          </div>
                          <div className="bg-purple-50 p-3 rounded-lg border-2 border-purple-300">
                            <div className="text-xs text-gray-600 mb-1">åˆè¨ˆ</div>
                            <div className="text-2xl font-bold text-purple-600">Â¥{stats.total.toLocaleString()}</div>
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          )}

          {view === 'office' && (
            <div className="max-w-7xl mx-auto px-4 py-6">
              <div className="bg-white rounded-xl shadow-lg p-6">
                <h2 className="text-2xl font-bold text-gray-800 mb-6">å–¶æ¥­æ‰€ãƒ»ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†</h2>

                {/* å–¶æ¥­æ‰€è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  */}
                <div className="mb-6">
                  <h3 className="text-lg font-semibold text-gray-700 mb-3">å–¶æ¥­æ‰€ã‚’è¿½åŠ </h3>
                  <div className="flex gap-2">
                    <input
                      type="text"
                      placeholder="å–¶æ¥­æ‰€å"
                      value={newOffice.name}
                      onChange={(e) => setNewOffice({ ...newOffice, name: e.target.value })}
                      className="border px-4 py-2 rounded-lg flex-1"
                    />
                    <input
                      type="text"
                      placeholder="ä½æ‰€"
                      value={newOffice.address}
                      onChange={(e) => setNewOffice({ ...newOffice, address: e.target.value })}
                      className="border px-4 py-2 rounded-lg flex-1"
                    />
                    <button
                      onClick={addOffice}
                      className="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600"
                    >
                      å–¶æ¥­æ‰€è¿½åŠ 
                    </button>
                  </div>
                </div>

                {/* å–¶æ¥­æ‰€ãƒªã‚¹ãƒˆ */}
                <div className="space-y-6">
                  {offices.map((office) => (
                    <div key={office.id} className="border rounded-xl p-5 shadow-sm bg-gray-50">
                      {/* å–¶æ¥­æ‰€ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                      <div className="flex justify-between items-center mb-4">
                        <div>
                          <h3 className="text-xl font-bold text-gray-800">{office.name}</h3>
                          <p className="text-sm text-gray-600">{office.address}</p>
                        </div>
                        <button
                          onClick={() => removeOffice(office.id)}
                          className="text-sm bg-red-500 text-white px-3 py-2 rounded hover:bg-red-600"
                        >
                          å–¶æ¥­æ‰€å‰Šé™¤
                        </button>
                      </div>

                      {/* ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ */}
                      <div className="mb-3">
                        <h4 className="font-semibold text-gray-700 mb-2">æ‰€å±ã‚¹ã‚¿ãƒƒãƒ•</h4>
                        {office.staff.length === 0 ? (
                          <p className="text-sm text-gray-500">ã‚¹ã‚¿ãƒƒãƒ•ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
                        ) : (
                          <ul className="space-y-2">
                            {office.staff.map((s) => (
                              <li
                                key={s.id}
                                className="flex justify-between items-center bg-white rounded-lg p-3 shadow-sm"
                              >
                                <div>
                                  <p className="font-semibold text-gray-800">{s.name}</p>
                                  <p className="text-xs text-gray-500">{s.role}</p>
                                </div>
                                <button
                                  onClick={() => removeStaff(office.id, s.id)}
                                  className="text-sm bg-red-400 text-white px-2 py-1 rounded hover:bg-red-500"
                                >
                                  å‰Šé™¤
                                </button>
                              </li>
                            ))}
                          </ul>
                        )}
                      </div>

                      {/* ã‚¹ã‚¿ãƒƒãƒ•è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  */}
                      <div className="flex gap-2 mt-3">
                        <input
                          type="text"
                          placeholder="ã‚¹ã‚¿ãƒƒãƒ•å"
                          value={newStaff.officeId === office.id ? newStaff.name : ''}
                          onChange={(e) => {
                            setNewStaff({
                              ...newStaff,
                              officeId: office.id,
                              name: e.target.value,
                            });
                          }}
                          className="border px-3 py-2 rounded-lg flex-1"
                        />
                        <select
                          value={newStaff.officeId === office.id ? newStaff.role : 'å–¶æ¥­æ‹…å½“'}
                          onChange={(e) =>
                            setNewStaff({
                              ...newStaff,
                              officeId: office.id,
                              role: e.target.value,
                            })
                          }
                          className="border px-3 py-2 rounded-lg"
                        >
                          <option value="å–¶æ¥­æ‹…å½“">å–¶æ¥­æ‹…å½“</option>
                          <option value="æ‰€é•·">æ‰€é•·</option>
                          <option value="çµŒç†">çµŒç†</option>
                        </select>
                        <button
                          onClick={addStaff}
                          className="bg-green-500 text-white px-3 py-2 rounded-lg hover:bg-green-600"
                        >
                          ã‚¹ã‚¿ãƒƒãƒ•è¿½åŠ 
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          )}

          {showPaymentDetail && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-2xl shadow-2xl w-full max-w-2xl">
                <div className={`${showPaymentDetail.type === 'å…¥é‡‘' ? 'bg-gradient-to-r from-green-500 to-green-600' : 'bg-gradient-to-r from-red-500 to-red-600'} p-6`}>
                  <div className="flex items-center justify-between">
                    <h3 className="text-2xl font-bold text-white flex items-center">
                      <DollarSign className="w-7 h-7 mr-2" />
                      {showPaymentDetail.type === 'å…¥é‡‘' ? 'å…¥é‡‘' : 'æ”¯æ‰•ã„'}è©³ç´°
                    </h3>
                    <button onClick={() => setShowPaymentDetail(null)} className="text-white">
                      <X className="w-6 h-6" />
                    </button>
                  </div>
                </div>
                <div className="p-6">
                  {(() => {
                    const contract = contracts.find(c => c.id === showPaymentDetail.contractId);
                    return (
                      <div className="space-y-4">
                        <div className="bg-gray-50 rounded-lg p-4">
                          <h4 className="font-semibold text-gray-800 mb-3">å–å¼•æƒ…å ±</h4>
                          <div className="grid grid-cols-2 gap-4 text-sm">
                            <div>
                              <div className="text-gray-600 mb-1">ã‚¿ã‚¤ãƒˆãƒ«</div>
                              <div className="font-semibold text-gray-800">{showPaymentDetail.title}</div>
                            </div>
                            <div>
                              <div className="text-gray-600 mb-1">é‡‘é¡</div>
                              <div className="font-bold text-2xl text-gray-800">Â¥{showPaymentDetail.amount?.toLocaleString()}</div>
                            </div>
                            <div>
                              <div className="text-gray-600 mb-1">ç¨®é¡</div>
                              <div className="font-semibold text-gray-800">{showPaymentDetail.type}</div>
                            </div>
                            <div>
                              <div className="text-gray-600 mb-1">æœŸæ—¥</div>
                              <div className="font-semibold text-gray-800">{showPaymentDetail.dueDate}</div>
                            </div>
                            {showPaymentDetail.purpose && (
                              <div className="col-span-2">
                                <div className="text-gray-600 mb-1">åç›®</div>
                                <div className="font-semibold text-gray-800">{showPaymentDetail.purpose}</div>
                              </div>
                            )}
                          </div>
                        </div>

                        {contract && (
                          <div className="bg-blue-50 rounded-lg p-4">
                            <h4 className="font-semibold text-gray-800 mb-3">ç‰©ä»¶æƒ…å ±</h4>
                            <div className="grid grid-cols-2 gap-4 text-sm">
                              <div>
                                <div className="text-gray-600 mb-1">ç‰©ä»¶ç¨®åˆ¥</div>
                                <div className="font-semibold text-gray-800">{contract.propertyType}</div>
                              </div>
                              <div>
                                <div className="text-gray-600 mb-1">å–å¼•ç¨®åˆ¥</div>
                                <div className="font-semibold text-gray-800">{contract.dealType}</div>
                              </div>
                              <div className="col-span-2">
                                <div className="text-gray-600 mb-1">
                                  {contract.propertyType === 'ãƒãƒ³ã‚·ãƒ§ãƒ³' ? 'ç‰©ä»¶åãƒ»å·å®¤' : 'æ‰€åœ¨åœ°'}
                                </div>
                                <div className="font-semibold text-gray-800">
                                  {contract.propertyType === 'ãƒãƒ³ã‚·ãƒ§ãƒ³'
                                    ? `${contract.propertyName} - ${contract.roomNumber}`
                                    : contract.address
                                  }
                                </div>
                              </div>
                            </div>
                          </div>
                        )}

                        {showPaymentDetail.paymentMethod && (
                          <div className="bg-orange-50 rounded-lg p-4">
                            <h4 className="font-semibold text-gray-800 mb-3">æ”¯æ‰•ãƒ»å—å–æ–¹æ³•</h4>
                            <div className="grid grid-cols-2 gap-4 text-sm">
                              <div>
                                <div className="text-gray-600 mb-1">
                                  {showPaymentDetail.type === 'å…¥é‡‘' ? 'å—å–æ–¹æ³•' : 'æ”¯æ‰•æ–¹æ³•'}
                                </div>
                                <div className="font-semibold text-gray-800">{showPaymentDetail.paymentMethod}</div>
                              </div>
                              {showPaymentDetail.receiptDelivery && (
                                <div>
                                  <div className="text-gray-600 mb-1">é ˜åæ›¸é…é€</div>
                                  <div className="font-semibold text-gray-800">{showPaymentDetail.receiptDelivery}</div>
                                </div>
                              )}
                            </div>
                          </div>
                        )}

                        <div className="flex justify-end space-x-3 pt-4 border-t border-gray-200">
                          {!showPaymentDetail.paymentCompleted && (
                            <button
                              onClick={() => handlePaymentComplete(showPaymentDetail.id, showPaymentDetail.type)}
                              className={`${showPaymentDetail.type === 'å…¥é‡‘' ? 'bg-green-500 hover:bg-green-600' : 'bg-red-500 hover:bg-red-600'} px-6 py-3 rounded-lg font-semibold transition-all flex items-center space-x-2 text-white`}
                            >
                              <Check className="w-5 h-5" />
                              <span>çµŒç†{showPaymentDetail.type === 'å…¥é‡‘' ? 'å…¥é‡‘' : 'æ”¯æ‰•ã„'}ç¢ºèª</span>
                            </button>
                          )}
                          {showPaymentDetail.paymentCompleted && (
                            <div className="px-6 py-3 bg-gray-100 text-gray-600 rounded-lg font-semibold flex items-center space-x-2">
                              <Check className="w-5 h-5" />
                              <span>ç¢ºèªæ¸ˆã¿</span>
                            </div>
                          )}
                          <button
                            onClick={() => setShowPaymentDetail(null)}
                            className="px-6 py-2 bg-gray-500 text-white rounded-lg font-semibold hover:bg-gray-600 transition-colors"
                          >
                            é–‰ã˜ã‚‹
                          </button>
                        </div>
                      </div>
                    );
                  })()}
                </div>
              </div>
            </div>
          )}

          {showTaskDetail && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-2xl shadow-2xl w-full max-w-2xl">
                <div className="border-b p-6">
                  <div className="flex items-center justify-between">
                    <h3 className="text-2xl font-bold text-gray-800">{showTaskDetail.title}</h3>
                    <button onClick={() => setShowTaskDetail(null)} className="text-gray-400">
                      <X className="w-6 h-6" />
                    </button>
                  </div>
                </div>
                <div className="p-6">
                  <div className="space-y-4">
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-1">ã‚¿ã‚¹ã‚¯ç¨®åˆ¥</label>
                        <div className="text-gray-800">{showTaskDetail.type}</div>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-1">æœŸæ—¥</label>
                        <div className="text-gray-800">{showTaskDetail.dueDate}</div>
                      </div>
                    </div>
                    <div className="flex space-x-3 pt-4">
                      <button onClick={() => { updateTaskStatus(showTaskDetail.id, 'in-progress'); setShowTaskDetail(null); }} className="flex-1 bg-blue-500 text-white py-3 rounded-lg font-semibold">æ‹…å½“è€…ç¢ºèª</button>
                      <button onClick={() => { updateTaskStatus(showTaskDetail.id, 'done'); setShowTaskDetail(null); }} className="flex-1 bg-green-500 text-white py-3 rounded-lg font-semibold">å®Œäº†</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          )}

          {showAddOffice && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md">
                <div className="border-b p-6">
                  <div className="flex items-center justify-between">
                    <h3 className="text-2xl font-bold text-gray-800">å–¶æ¥­æ‰€ã‚’è¿½åŠ </h3>
                    <button onClick={() => setShowAddOffice(false)} className="text-gray-400">
                      <X className="w-6 h-6" />
                    </button>
                  </div>
                </div>
                <div className="p-6 space-y-4">
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">å–¶æ¥­æ‰€å *</label>
                    <input type="text" value={newOffice.name} onChange={(e) => setNewOffice({ ...newOffice, name: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                  </div>
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">ä½æ‰€ *</label>
                    <input type="text" value={newOffice.address} onChange={(e) => setNewOffice({ ...newOffice, address: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                  </div>
                  <div className="flex justify-end space-x-3 pt-4">
                    <button onClick={() => setShowAddOffice(false)} className="px-6 py-2 border rounded-lg text-gray-700">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button onClick={handleAddOffice} className="px-6 py-2 bg-orange-500 text-white rounded-lg font-semibold">è¿½åŠ </button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {showAddStaff && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md">
                <div className="border-b p-6">
                  <div className="flex items-center justify-between">
                    <h3 className="text-2xl font-bold text-gray-800">ã‚¹ã‚¿ãƒƒãƒ•ã‚’è¿½åŠ </h3>
                    <button onClick={() => setShowAddStaff(false)} className="text-gray-400">
                      <X className="w-6 h-6" />
                    </button>
                  </div>
                </div>
                <div className="p-6 space-y-4">
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">åå‰ *</label>
                    <input type="text" value={newStaff.name} onChange={(e) => setNewStaff({ ...newStaff, name: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                  </div>
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">å–¶æ¥­æ‰€ *</label>
                    <select value={newStaff.officeId} onChange={(e) => setNewStaff({ ...newStaff, officeId: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                      <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                      {offices.map(office => (
                        <option key={office.id} value={office.id}>{office.name}</option>
                      ))}
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">å½¹è·</label>
                    <select value={newStaff.role} onChange={(e) => setNewStaff({ ...newStaff, role: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                      <option value="å–¶æ¥­æ‹…å½“">å–¶æ¥­æ‹…å½“</option>
                      <option value="æ‰€é•·">æ‰€é•·</option>
                      <option value="çµŒç†">çµŒç†</option>
                    </select>
                  </div>
                  <div className="flex justify-end space-x-3 pt-4">
                    <button onClick={() => setShowAddStaff(false)} className="px-6 py-2 border rounded-lg text-gray-700">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button onClick={handleAddStaff} className="px-6 py-2 bg-blue-500 text-white rounded-lg font-semibold">è¿½åŠ </button>
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<RealEstateTaskManager />);
  </script>
</body>
</html>
