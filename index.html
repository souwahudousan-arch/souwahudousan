<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>不動産契約進捗管理（スタンドアロン）</title>

  <!-- React 18 UMD -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

  <!-- Babel (ブラウザでJSX変換用) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- TailwindCSS（CDN） -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>

  <style>
    body { background: #f7fafc; font-feature-settings: "palt" 1; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    // ====== lucide-react の代替:簡易SVGアイコン ======
    const makeIcon = (label) => ({ className = "w-5 h-5", ...rest }) => (
      <svg
        className={className}
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
        aria-label={label}
        {...rest}
      >
        <rect x="3" y="3" width="18" height="18" rx="4" ry="4"></rect>
        <text x="12" y="15" textAnchor="middle" fontSize="8" fontFamily="sans-serif">
          {label?.[0] || "I"}
        </text>
      </svg>
    );

    const Bell = makeIcon('Bell');
    const Plus = makeIcon('Plus');
    const X = makeIcon('X');
    const Calendar = makeIcon('Cal');
    const User = makeIcon('User');
    const Building2 = makeIcon('Bld');
    const AlertCircle = makeIcon('!');
    const Check = makeIcon('OK');
    const Clock = makeIcon('Clk');
    const ChevronRight = makeIcon('>');
    const Users = makeIcon('Usr');
    const MapPin = makeIcon('Pin');
    const Briefcase = makeIcon('Job');
    const DollarSign = makeIcon('¥');
    const FileText = makeIcon('Doc');
    const Upload = makeIcon('Up');
    const TrendingUp = makeIcon('UpT');
    const BarChart3 = makeIcon('Bar');
    const Search = makeIcon('Srch');
    const Filter = makeIcon('Fltr');
    const Download = makeIcon('DL');
    const Edit2 = makeIcon('Edt');
    const Save = makeIcon('Sav');
    const LayoutDashboard = makeIcon('Dsh');
    const PieChart = makeIcon('Pie');
    const Home = makeIcon('Home');

    // ====== React本体 ======
    const { useState, useMemo } = React;

    const RealEstateTaskManager = () => {
      const [view, setView] = useState('dashboard');
      const [selectedContract, setSelectedContract] = useState(1);
      const [selectedProperty, setSelectedProperty] = useState(null);
      const [showNewContract, setShowNewContract] = useState(false);
      const [showEditContract, setShowEditContract] = useState(false);
      const [showNewProperty, setShowNewProperty] = useState(false);
      const [showEditProperty, setShowEditProperty] = useState(false);
      const [editingContract, setEditingContract] = useState(null);
      const [editingProperty, setEditingProperty] = useState(null);
      const [editContractTab, setEditContractTab] = useState('basic');
      const [showTaskDetail, setShowTaskDetail] = useState(null);
      const [isEditingTask, setIsEditingTask] = useState(false);
      const [editedTask, setEditedTask] = useState(null);
      const [showPaymentDetail, setShowPaymentDetail] = useState(null);

      const [salesPeriodType, setSalesPeriodType] = useState('month');
      const [salesYear, setSalesYear] = useState(2025);
      const [salesMonth, setSalesMonth] = useState(10);

      const [currentStep, setCurrentStep] = useState(1);
      const [editStep, setEditStep] = useState(1);
      const [propertyStep, setPropertyStep] = useState(1);
      const [editPropertyStep, setEditPropertyStep] = useState(1);
      const totalSteps = 7;
      const totalPropertySteps = 4;

      const [searchQuery, setSearchQuery] = useState('');
      const [priorityFilter, setPriorityFilter] = useState('all');
      const [typeFilter, setTypeFilter] = useState('all');
      const [statusFilter, setStatusFilter] = useState('all');
      const [dateFilter, setDateFilter] = useState('all');
      const [showFilters, setShowFilters] = useState(false);
      const [officeFilter, setOfficeFilter] = useState('all');

      const [showAddOffice, setShowAddOffice] = useState(false);
      const [showAddStaff, setShowAddStaff] = useState(false);

      // 🏠 物件マスタのstate
      const [properties, setProperties] = useState([
        {
          id: 1,
          propertyType: 'マンション',
          address: '東京都渋谷区神宮前1-1-1',
          propertyName: 'パークマンション渋谷',
          roomNumber: '305',
          buildingStructure: 'RC造',
          buildYear: '2015',
          landArea: '100',
          buildingArea: '80',
          notes: ''
        }
      ]);

      const [newProperty, setNewProperty] = useState({
        propertyType: 'マンション',
        address: '',
        propertyName: '',
        roomNumber: '',
        buildingStructure: '',
        buildYear: '',
        landArea: '',
        buildingArea: '',
        notes: ''
      });

      const [newContract, setNewContract] = useState({
        propertyId: '', // 物件との紐付け
        propertyType: 'マンション', address: '', propertyName: '', roomNumber: '',
        dealType: '仲介', buyerName: '', buyerKana: '', sellerName: '', sellerKana: '',
        propertyPrice: '', outstandingDebt: '', consumptionTax: '', loanUsage: false,
        loanApprovalDate: '', mortgageRemoval: false, arrears: false, demolition: false,
        renovation: false, survey: false, contractDate: '', settlementDeadline: '',
        confirmedSettlementDate: '', officeId: '', assigneeId: '',
        manualRevenue: '',
        buyerPaymentEnabled: false, buyerPaymentSplit: false,
        buyerPayments: [{ category: '仲介手数料', amount: '', dueDate: '', method: '振込', receipt: '郵送' }],
        sellerPaymentEnabled: false, sellerPaymentSplit: false,
        sellerPayments: [{ category: '仲介手数料', amount: '', dueDate: '', method: '振込', receipt: '郵送' }],
        vendor1PaymentEnabled: false,
        vendor1Payments: [{ category: '紹介料', amount: '', dueDate: '', method: '振込', receipt: '郵送' }],
        vendor2PaymentEnabled: false,
        vendor2Payments: [{ category: '紹介料', amount: '', dueDate: '', method: '振込', receipt: '郵送' }],
        vendor3PaymentEnabled: false,
        vendor3Payments: [{ category: '紹介料', amount: '', dueDate: '', method: '振込', receipt: '郵送' }],
        buyerExpenseEnabled: false,
        buyerExpenses: [{ category: '返金', amount: '', dueDate: '', accountImages: [] }],
        sellerExpenseEnabled: false,
        sellerExpenses: [{ category: '手付金', amount: '', dueDate: '', accountImages: [] }],
        vendor1ExpenseEnabled: false,
        vendor1Expenses: [{ category: '仲介手数料', amount: '', dueDate: '', accountImages: [] }],
        vendor2ExpenseEnabled: false,
        vendor2Expenses: [{ category: '仲介手数料', amount: '', dueDate: '', accountImages: [] }],
        vendor3ExpenseEnabled: false,
        vendor3Expenses: [{ category: '仲介手数料', amount: '', dueDate: '', accountImages: [] }]
      });

      const [contracts, setContracts] = useState([
        {
          id: 1, propertyId: 1, propertyType: 'マンション', address: '東京都渋谷区神宮前1-1-1',
          propertyName: 'パークマンション渋谷', roomNumber: '305', dealType: '仲介',
          buyerName: '田中太郎', buyerKana: 'タナカタロウ', sellerName: '山田次郎',
          sellerKana: 'ヤマダジロウ', propertyPrice: 50000000, outstandingDebt: 30000000,
          consumptionTax: 0, manualRevenue: 0, loanUsage: true, loanApprovalDate: '2025-11-10',
          mortgageRemoval: true, arrears: false, demolition: false, renovation: true,
          survey: false, contractDate: '2025-10-15', settlementDeadline: '2025-11-30',
          confirmedSettlementDate: '', assigneeId: 1, officeId: 1, status: '契約準備中', progress: 30,
          buyerPayments: [], sellerPayments: [], vendor1Payments: [], vendor2Payments: [], vendor3Payments: [],
          buyerExpenses: [], sellerExpenses: [], vendor1Expenses: [], vendor2Expenses: [], vendor3Expenses: []
        }
      ]);

      const [tasks, setTasks] = useState([
        { id: 1, contractId: 1, propertyId: 1, type: '入金', title: '買主から仲介手数料入金', amount: 1500000, purpose: '仲介手数料', paymentMethod: '振込', receiptDelivery: '郵送', dueDate: '2025-11-30', status: 'pending', assigneeId: 1, priority: 'high', paymentCompleted: false },
        { id: 2, contractId: 1, propertyId: 1, type: '抵当権抹消', title: '抵当権抹消事前手続き', dueDate: '2025-10-30', status: 'in-progress', assigneeId: 1, priority: 'high', paymentCompleted: false },
        { id: 3, contractId: 1, propertyId: 1, type: 'リフォーム', title: 'リフォーム業者との打ち合わせ', dueDate: '2025-11-15', status: 'pending', assigneeId: 1, priority: 'medium', paymentCompleted: false }
      ]);

      const [offices, setOffices] = useState([
        { id: 1, name: '渋谷営業所', address: '東京都渋谷区〇〇' },
        { id: 2, name: '新宿営業所', address: '東京都新宿区〇〇' }
      ]);

      const [staff, setStaff] = useState([
        { id: 1, name: '佐藤一郎', officeId: 1, role: '営業担当' },
        { id: 2, name: '鈴木花子', officeId: 1, role: '所長' },
        { id: 3, name: '高橋太郎', officeId: 2, role: '営業担当' }
      ]);

      const [newOffice, setNewOffice] = useState({ name: '', address: '' });
      const [newStaff, setNewStaff] = useState({ name: '', officeId: '', role: '営業担当' });

      // 🏠 物件追加ハンドラー
      const handleAddProperty = () => {
        if (!newProperty.address || !newProperty.propertyName) {
          alert('住所と物件名は必須です');
          return;
        }
        const property = {
          ...newProperty,
          id: properties.length > 0 ? Math.max(...properties.map(p => p.id)) + 1 : 1
        };
        setProperties([...properties, property]);
        setNewProperty({
          propertyType: 'マンション',
          address: '',
          propertyName: '',
          roomNumber: '',
          buildingStructure: '',
          buildYear: '',
          landArea: '',
          buildingArea: '',
          notes: ''
        });
        setPropertyStep(1);
        setShowNewProperty(false);
        alert('物件を追加しました');
      };

      // 🏠 物件編集ハンドラー
      const handleEditProperty = () => {
        if (!editingProperty.address || !editingProperty.propertyName) {
          alert('住所と物件名は必須です');
          return;
        }
        setProperties(properties.map(p => p.id === editingProperty.id ? editingProperty : p));
        setEditingProperty(null);
        setEditPropertyStep(1);
        setShowEditProperty(false);
        alert('物件を更新しました');
      };

      // 🏠 物件削除ハンドラー
      const handleDeleteProperty = (id) => {
        if (confirm('この物件を削除しますか？')) {
          setProperties(properties.filter(p => p.id !== id));
        }
      };

      const handleAddContract = () => {
        if (currentStep < totalSteps) return;
        if (!newContract.address || !newContract.dealType) {
          alert('住所と取引種別は必須です');
          return;
        }
        const contract = {
          ...newContract,
          id: contracts.length > 0 ? Math.max(...contracts.map(c => c.id)) + 1 : 1,
          status: '契約準備中',
          progress: 0
        };
        setContracts([...contracts, contract]);
        setNewContract({
          propertyId: '',
          propertyType: 'マンション', address: '', propertyName: '', roomNumber: '',
          dealType: '仲介', buyerName: '', buyerKana: '', sellerName: '', sellerKana: '',
          propertyPrice: '', outstandingDebt: '', consumptionTax: '', loanUsage: false,
          loanApprovalDate: '', mortgageRemoval: false, arrears: false, demolition: false,
          renovation: false, survey: false, contractDate: '', settlementDeadline: '',
          confirmedSettlementDate: '', officeId: '', assigneeId: '',
          manualRevenue: '',
          buyerPaymentEnabled: false, buyerPaymentSplit: false,
          buyerPayments: [{ category: '仲介手数料', amount: '', dueDate: '', method: '振込', receipt: '郵送' }],
          sellerPaymentEnabled: false, sellerPaymentSplit: false,
          sellerPayments: [{ category: '仲介手数料', amount: '', dueDate: '', method: '振込', receipt: '郵送' }],
          vendor1PaymentEnabled: false,
          vendor1Payments: [{ category: '紹介料', amount: '', dueDate: '', method: '振込', receipt: '郵送' }],
          vendor2PaymentEnabled: false,
          vendor2Payments: [{ category: '紹介料', amount: '', dueDate: '', method: '振込', receipt: '郵送' }],
          vendor3PaymentEnabled: false,
          vendor3Payments: [{ category: '紹介料', amount: '', dueDate: '', method: '振込', receipt: '郵送' }],
          buyerExpenseEnabled: false,
          buyerExpenses: [{ category: '返金', amount: '', dueDate: '', accountImages: [] }],
          sellerExpenseEnabled: false,
          sellerExpenses: [{ category: '手付金', amount: '', dueDate: '', accountImages: [] }],
          vendor1ExpenseEnabled: false,
          vendor1Expenses: [{ category: '仲介手数料', amount: '', dueDate: '', accountImages: [] }],
          vendor2ExpenseEnabled: false,
          vendor2Expenses: [{ category: '仲介手数料', amount: '', dueDate: '', accountImages: [] }],
          vendor3ExpenseEnabled: false,
          vendor3Expenses: [{ category: '仲介手数料', amount: '', dueDate: '', accountImages: [] }]
        });
        setCurrentStep(1);
        setShowNewContract(false);
        alert('契約を追加しました');
      };

      const handleEditContractSave = () => {
        if (!editingContract.address || !editingContract.dealType) {
          alert('住所と取引種別は必須です');
          return;
        }
        setContracts(contracts.map(c => c.id === editingContract.id ? editingContract : c));
        setEditingContract(null);
        setEditStep(1);
        setShowEditContract(false);
        alert('契約を更新しました');
      };

      const handleAddOffice = () => {
        if (!newOffice.name || !newOffice.address) {
          alert('営業所名と住所は必須です');
          return;
        }
        const office = {
          ...newOffice,
          id: offices.length > 0 ? Math.max(...offices.map(o => o.id)) + 1 : 1
        };
        setOffices([...offices, office]);
        setNewOffice({ name: '', address: '' });
        setShowAddOffice(false);
      };

      const handleAddStaff = () => {
        if (!newStaff.name || !newStaff.officeId) {
          alert('名前と営業所は必須です');
          return;
        }
        const member = {
          ...newStaff,
          officeId: Number(newStaff.officeId),
          id: staff.length > 0 ? Math.max(...staff.map(s => s.id)) + 1 : 1
        };
        setStaff([...staff, member]);
        setNewStaff({ name: '', officeId: '', role: '営業担当' });
        setShowAddStaff(false);
      };

      const updateTaskStatus = (taskId, status) => {
        setTasks(tasks.map(t => t.id === taskId ? { ...t, status } : t));
      };

      const handlePaymentComplete = (taskId, taskType) => {
        setTasks(tasks.map(t => t.id === taskId ? { ...t, paymentCompleted: true, status: 'done' } : t));
        setShowPaymentDetail(null);
        alert(`${taskType}を確認しました`);
      };

      const filteredTasks = useMemo(() => {
        let filtered = tasks.filter(task => {
          const contract = contracts.find(c => c.id === task.contractId);
          if (!contract) return false;
          
          // 物件フィルター
          if (selectedProperty && task.propertyId !== selectedProperty) return false;
          
          const office = offices.find(o => o.id === contract.officeId);
          if (officeFilter !== 'all' && contract.officeId !== Number(officeFilter)) return false;
          
          const matchesSearch = task.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
            (contract.propertyName && contract.propertyName.toLowerCase().includes(searchQuery.toLowerCase())) ||
            (contract.address && contract.address.toLowerCase().includes(searchQuery.toLowerCase()));
          if (searchQuery && !matchesSearch) return false;
          
          if (priorityFilter !== 'all' && task.priority !== priorityFilter) return false;
          if (typeFilter !== 'all' && task.type !== typeFilter) return false;
          if (statusFilter !== 'all' && task.status !== statusFilter) return false;
          
          if (dateFilter !== 'all') {
            const today = new Date();
            const dueDate = new Date(task.dueDate);
            const daysDiff = Math.floor((dueDate - today) / (1000 * 60 * 60 * 24));
            if (dateFilter === 'overdue' && daysDiff >= 0) return false;
            if (dateFilter === 'today' && daysDiff !== 0) return false;
            if (dateFilter === 'week' && (daysDiff < 0 || daysDiff > 7)) return false;
            if (dateFilter === 'month' && (daysDiff < 0 || daysDiff > 30)) return false;
          }
          
          return true;
        });
        
        filtered.sort((a, b) => {
          const priorityOrder = { high: 0, medium: 1, low: 2 };
          if (a.priority !== b.priority) {
            return priorityOrder[a.priority] - priorityOrder[b.priority];
          }
          return new Date(a.dueDate) - new Date(b.dueDate);
        });
        
        return filtered;
      }, [tasks, searchQuery, priorityFilter, typeFilter, statusFilter, dateFilter, contracts, officeFilter, offices, selectedProperty]);

      const taskStats = useMemo(() => {
        const pending = tasks.filter(t => t.status === 'pending').length;
        const inProgress = tasks.filter(t => t.status === 'in-progress').length;
        const done = tasks.filter(t => t.status === 'done').length;
        const overdue = tasks.filter(t => {
          const today = new Date();
          const dueDate = new Date(t.dueDate);
          return t.status !== 'done' && dueDate < today;
        }).length;
        return { pending, inProgress, done, overdue, total: tasks.length };
      }, [tasks]);

      // サイドバーのナビゲーション
      const navigation = [
        { id: 'dashboard', label: 'ダッシュボード', icon: LayoutDashboard },
        { id: 'properties', label: '物件一覧', icon: Home },
        { id: 'contracts', label: '契約管理', icon: FileText },
        { id: 'tasks', label: 'タスク管理', icon: Clock },
        { id: 'offices', label: '営業所管理', icon: Building2 },
        { id: 'staff', label: 'スタッフ管理', icon: Users }
      ];

      return (
        <div className="flex h-screen bg-gray-50">
          {/* サイドバー */}
          <div className="w-64 bg-gradient-to-b from-orange-600 to-orange-700 text-white flex flex-col shadow-xl">
            <div className="p-6 border-b border-orange-500">
              <h1 className="text-xl font-bold">不動産契約管理</h1>
              <p className="text-orange-100 text-sm mt-1">進捗管理システム</p>
            </div>
            
            <nav className="flex-1 p-4 space-y-2 overflow-y-auto">
              {navigation.map(item => {
                const Icon = item.icon;
                return (
                  <button
                    key={item.id}
                    onClick={() => {
                      setView(item.id);
                      setSelectedProperty(null); // 物件フィルターをリセット
                    }}
                    className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all ${
                      view === item.id
                        ? 'bg-white text-orange-600 shadow-lg font-semibold'
                        : 'text-orange-100 hover:bg-orange-500 hover:text-white'
                    }`}
                  >
                    <Icon className="w-5 h-5" />
                    <span>{item.label}</span>
                  </button>
                );
              })}
            </nav>

            <div className="p-4 border-t border-orange-500">
              <div className="flex items-center space-x-3 px-4 py-3">
                <User className="w-5 h-5" />
                <span className="text-sm">管理者</span>
              </div>
            </div>
          </div>

          {/* メインコンテンツ */}
          <div className="flex-1 overflow-auto">
            {/* ダッシュボード */}
            {view === 'dashboard' && (
              <div className="p-8 space-y-6">
                <div className="flex justify-between items-center">
                  <h2 className="text-3xl font-bold text-gray-800">ダッシュボード</h2>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                  <div className="bg-white rounded-xl p-6 shadow-md border-l-4 border-blue-500">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-gray-500 text-sm font-medium">未着手</p>
                        <p className="text-3xl font-bold text-gray-800 mt-2">{taskStats.pending}</p>
                      </div>
                      <div className="bg-blue-100 p-3 rounded-full">
                        <Clock className="w-6 h-6 text-blue-600" />
                      </div>
                    </div>
                  </div>

                  <div className="bg-white rounded-xl p-6 shadow-md border-l-4 border-yellow-500">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-gray-500 text-sm font-medium">進行中</p>
                        <p className="text-3xl font-bold text-gray-800 mt-2">{taskStats.inProgress}</p>
                      </div>
                      <div className="bg-yellow-100 p-3 rounded-full">
                        <TrendingUp className="w-6 h-6 text-yellow-600" />
                      </div>
                    </div>
                  </div>

                  <div className="bg-white rounded-xl p-6 shadow-md border-l-4 border-green-500">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-gray-500 text-sm font-medium">完了</p>
                        <p className="text-3xl font-bold text-gray-800 mt-2">{taskStats.done}</p>
                      </div>
                      <div className="bg-green-100 p-3 rounded-full">
                        <Check className="w-6 h-6 text-green-600" />
                      </div>
                    </div>
                  </div>

                  <div className="bg-white rounded-xl p-6 shadow-md border-l-4 border-red-500">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-gray-500 text-sm font-medium">期限超過</p>
                        <p className="text-3xl font-bold text-gray-800 mt-2">{taskStats.overdue}</p>
                      </div>
                      <div className="bg-red-100 p-3 rounded-full">
                        <AlertCircle className="w-6 h-6 text-red-600" />
                      </div>
                    </div>
                  </div>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  <div className="bg-white rounded-xl p-6 shadow-md">
                    <h3 className="text-xl font-bold text-gray-800 mb-4">契約状況</h3>
                    <div className="space-y-3">
                      <div className="flex justify-between items-center">
                        <span className="text-gray-600">総契約数</span>
                        <span className="font-bold text-gray-800">{contracts.length}件</span>
                      </div>
                      <div className="flex justify-between items-center">
                        <span className="text-gray-600">進行中</span>
                        <span className="font-bold text-blue-600">
                          {contracts.filter(c => c.status === '契約準備中' || c.status === '決済準備中').length}件
                        </span>
                      </div>
                    </div>
                  </div>

                  <div className="bg-white rounded-xl p-6 shadow-md">
                    <h3 className="text-xl font-bold text-gray-800 mb-4">物件状況</h3>
                    <div className="space-y-3">
                      <div className="flex justify-between items-center">
                        <span className="text-gray-600">登録物件数</span>
                        <span className="font-bold text-gray-800">{properties.length}件</span>
                      </div>
                      <div className="flex justify-between items-center">
                        <span className="text-gray-600">契約済物件</span>
                        <span className="font-bold text-green-600">
                          {properties.filter(p => contracts.some(c => c.propertyId === p.id)).length}件
                        </span>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-xl p-6 shadow-md">
                  <h3 className="text-xl font-bold text-gray-800 mb-4">直近のタスク</h3>
                  <div className="space-y-3">
                    {filteredTasks.slice(0, 5).map(task => {
                      const contract = contracts.find(c => c.id === task.contractId);
                      const property = properties.find(p => p.id === task.propertyId);
                      return (
                        <div key={task.id} className="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                          <div className="flex-1">
                            <div className="font-semibold text-gray-800">{task.title}</div>
                            <div className="text-sm text-gray-500 mt-1">
                              {property ? `${property.propertyName} ${property.roomNumber || ''}` : '物件情報なし'}
                            </div>
                          </div>
                          <div className="text-sm text-gray-600">{task.dueDate}</div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            )}

            {/* 🏠 物件一覧 */}
            {view === 'properties' && (
              <div className="p-8 space-y-6">
                <div className="flex justify-between items-center">
                  <h2 className="text-3xl font-bold text-gray-800">物件一覧</h2>
                  <button
                    onClick={() => setShowNewProperty(true)}
                    className="bg-orange-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-orange-600 transition-colors flex items-center space-x-2 shadow-lg"
                  >
                    <Plus className="w-5 h-5" />
                    <span>物件を追加</span>
                  </button>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                  {properties.map(property => {
                    const relatedContracts = contracts.filter(c => c.propertyId === property.id);
                    const relatedTasks = tasks.filter(t => t.propertyId === property.id);
                    const pendingTasks = relatedTasks.filter(t => t.status === 'pending' || t.status === 'in-progress');
                    
                    return (
                      <div key={property.id} className="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-shadow">
                        <div className="bg-gradient-to-r from-orange-500 to-orange-600 p-4">
                          <div className="flex items-start justify-between">
                            <div className="flex-1">
                              <div className="text-white font-bold text-lg">{property.propertyName}</div>
                              <div className="text-orange-100 text-sm mt-1">{property.roomNumber}</div>
                            </div>
                            <div className="bg-white bg-opacity-20 px-3 py-1 rounded-full text-white text-sm">
                              {property.propertyType}
                            </div>
                          </div>
                        </div>

                        <div className="p-4 space-y-3">
                          <div className="flex items-start space-x-2">
                            <MapPin className="w-4 h-4 text-gray-400 mt-1 flex-shrink-0" />
                            <div className="text-sm text-gray-600">{property.address}</div>
                          </div>

                          {property.buildingStructure && (
                            <div className="text-sm text-gray-600">
                              <span className="font-semibold">構造：</span>{property.buildingStructure}
                            </div>
                          )}

                          {property.buildYear && (
                            <div className="text-sm text-gray-600">
                              <span className="font-semibold">築年：</span>{property.buildYear}年
                            </div>
                          )}

                          <div className="pt-3 border-t border-gray-200">
                            <div className="flex items-center justify-between text-sm">
                              <span className="text-gray-600">関連契約</span>
                              <span className="font-bold text-gray-800">{relatedContracts.length}件</span>
                            </div>
                            <div className="flex items-center justify-between text-sm mt-2">
                              <span className="text-gray-600">進行中タスク</span>
                              <span className="font-bold text-orange-600">{pendingTasks.length}件</span>
                            </div>
                          </div>

                          <div className="flex space-x-2 pt-3">
                            <button
                              onClick={() => {
                                setSelectedProperty(property.id);
                                setView('tasks');
                              }}
                              className="flex-1 bg-blue-500 text-white py-2 rounded-lg text-sm font-semibold hover:bg-blue-600 transition-colors"
                            >
                              タスク表示
                            </button>
                            <button
                              onClick={() => {
                                setEditingProperty(property);
                                setShowEditProperty(true);
                              }}
                              className="flex-1 bg-gray-500 text-white py-2 rounded-lg text-sm font-semibold hover:bg-gray-600 transition-colors"
                            >
                              編集
                            </button>
                            <button
                              onClick={() => handleDeleteProperty(property.id)}
                              className="bg-red-500 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-red-600 transition-colors"
                            >
                              削除
                            </button>
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>

                {properties.length === 0 && (
                  <div className="bg-white rounded-xl p-12 text-center shadow-md">
                    <Home className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                    <p className="text-gray-500 text-lg">物件が登録されていません</p>
                    <p className="text-gray-400 text-sm mt-2">「物件を追加」ボタンから登録してください</p>
                  </div>
                )}
              </div>
            )}

            {/* 契約管理 */}
            {view === 'contracts' && (
              <div className="p-8 space-y-6">
                <div className="flex justify-between items-center">
                  <h2 className="text-3xl font-bold text-gray-800">契約管理</h2>
                  <button
                    onClick={() => setShowNewContract(true)}
                    className="bg-orange-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-orange-600 transition-colors flex items-center space-x-2 shadow-lg"
                  >
                    <Plus className="w-5 h-5" />
                    <span>契約を追加</span>
                  </button>
                </div>

                <div className="space-y-4">
                  {contracts.map(contract => {
                    const assignee = staff.find(s => s.id === contract.assigneeId);
                    const office = offices.find(o => o.id === contract.officeId);
                    const property = properties.find(p => p.id === contract.propertyId);
                    
                    return (
                      <div key={contract.id} className="bg-white rounded-xl shadow-md p-6 hover:shadow-lg transition-shadow">
                        <div className="flex items-start justify-between">
                          <div className="flex-1">
                            <div className="flex items-center space-x-3 mb-2">
                              <h3 className="text-xl font-bold text-gray-800">
                                {contract.propertyName} {contract.roomNumber}
                              </h3>
                              <span className="px-3 py-1 bg-orange-100 text-orange-600 rounded-full text-sm font-semibold">
                                {contract.dealType}
                              </span>
                              {property && (
                                <span className="px-3 py-1 bg-blue-100 text-blue-600 rounded-full text-sm font-semibold">
                                  物件ID: {property.id}
                                </span>
                              )}
                            </div>
                            <p className="text-gray-600">{contract.address}</p>
                            <div className="flex items-center space-x-4 mt-3 text-sm text-gray-500">
                              <span>買主: {contract.buyerName}</span>
                              <span>売主: {contract.sellerName}</span>
                              {assignee && <span>担当: {assignee.name}</span>}
                              {office && <span>営業所: {office.name}</span>}
                            </div>
                          </div>
                          <button
                            onClick={() => {
                              setEditingContract(contract);
                              setShowEditContract(true);
                            }}
                            className="bg-blue-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-600 transition-colors flex items-center space-x-2"
                          >
                            <Edit2 className="w-4 h-4" />
                            <span>編集</span>
                          </button>
                        </div>

                        <div className="mt-4 pt-4 border-t border-gray-200">
                          <div className="grid grid-cols-3 gap-4 text-sm">
                            <div>
                              <span className="text-gray-500">契約日:</span>
                              <span className="ml-2 font-semibold">{contract.contractDate}</span>
                            </div>
                            <div>
                              <span className="text-gray-500">決済期限:</span>
                              <span className="ml-2 font-semibold">{contract.settlementDeadline}</span>
                            </div>
                            <div>
                              <span className="text-gray-500">物件価格:</span>
                              <span className="ml-2 font-semibold">{Number(contract.propertyPrice).toLocaleString()}円</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>

                {contracts.length === 0 && (
                  <div className="bg-white rounded-xl p-12 text-center shadow-md">
                    <FileText className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                    <p className="text-gray-500 text-lg">契約が登録されていません</p>
                    <p className="text-gray-400 text-sm mt-2">「契約を追加」ボタンから登録してください</p>
                  </div>
                )}
              </div>
            )}

            {/* タスク管理 */}
            {view === 'tasks' && (
              <div className="p-8 space-y-6">
                <div className="flex justify-between items-center">
                  <div>
                    <h2 className="text-3xl font-bold text-gray-800">タスク管理</h2>
                    {selectedProperty && (
                      <p className="text-gray-600 mt-2">
                        {properties.find(p => p.id === selectedProperty)?.propertyName} のタスク
                        <button
                          onClick={() => setSelectedProperty(null)}
                          className="ml-4 text-sm text-orange-500 hover:text-orange-600 underline"
                        >
                          フィルター解除
                        </button>
                      </p>
                    )}
                  </div>
                  <button
                    onClick={() => setShowFilters(!showFilters)}
                    className="bg-gray-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors flex items-center space-x-2"
                  >
                    <Filter className="w-5 h-5" />
                    <span>フィルター</span>
                  </button>
                </div>

                {showFilters && (
                  <div className="bg-white rounded-xl p-6 shadow-md space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">検索</label>
                        <input
                          type="text"
                          value={searchQuery}
                          onChange={(e) => setSearchQuery(e.target.value)}
                          placeholder="タスクを検索..."
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">優先度</label>
                        <select
                          value={priorityFilter}
                          onChange={(e) => setPriorityFilter(e.target.value)}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        >
                          <option value="all">すべて</option>
                          <option value="high">高</option>
                          <option value="medium">中</option>
                          <option value="low">低</option>
                        </select>
                      </div>

                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">タスク種別</label>
                        <select
                          value={typeFilter}
                          onChange={(e) => setTypeFilter(e.target.value)}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        >
                          <option value="all">すべて</option>
                          <option value="入金">入金</option>
                          <option value="支払い">支払い</option>
                          <option value="抵当権抹消">抵当権抹消</option>
                          <option value="リフォーム">リフォーム</option>
                        </select>
                      </div>

                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">ステータス</label>
                        <select
                          value={statusFilter}
                          onChange={(e) => setStatusFilter(e.target.value)}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        >
                          <option value="all">すべて</option>
                          <option value="pending">未着手</option>
                          <option value="in-progress">進行中</option>
                          <option value="done">完了</option>
                        </select>
                      </div>
                    </div>
                  </div>
                )}

                <div className="space-y-4">
                  {filteredTasks.map(task => {
                    const contract = contracts.find(c => c.id === task.contractId);
                    const property = properties.find(p => p.id === task.propertyId);
                    const assignee = staff.find(s => s.id === task.assigneeId);

                    const statusConfig = {
                      pending: { bg: 'bg-gray-100', text: 'text-gray-600', label: '未着手' },
                      'in-progress': { bg: 'bg-blue-100', text: 'text-blue-600', label: '進行中' },
                      done: { bg: 'bg-green-100', text: 'text-green-600', label: '完了' }
                    };

                    const priorityConfig = {
                      high: { bg: 'bg-red-100', text: 'text-red-600', label: '高' },
                      medium: { bg: 'bg-yellow-100', text: 'text-yellow-600', label: '中' },
                      low: { bg: 'bg-gray-100', text: 'text-gray-600', label: '低' }
                    };

                    const status = statusConfig[task.status];
                    const priority = priorityConfig[task.priority];

                    return (
                      <div
                        key={task.id}
                        className="bg-white rounded-xl shadow-md p-6 hover:shadow-lg transition-shadow cursor-pointer"
                        onClick={() => {
                          if (task.type === '入金' || task.type === '支払い') {
                            setShowPaymentDetail(task);
                          } else {
                            setShowTaskDetail(task);
                          }
                        }}
                      >
                        <div className="flex items-start justify-between">
                          <div className="flex-1">
                            <div className="flex items-center space-x-3 mb-2">
                              <h3 className="text-lg font-bold text-gray-800">{task.title}</h3>
                              <span className={`px-3 py-1 ${status.bg} ${status.text} rounded-full text-sm font-semibold`}>
                                {status.label}
                              </span>
                              <span className={`px-3 py-1 ${priority.bg} ${priority.text} rounded-full text-sm font-semibold`}>
                                優先度: {priority.label}
                              </span>
                            </div>

                            {property && (
                              <p className="text-gray-600 text-sm mb-2">
                                {property.propertyName} {property.roomNumber}
                              </p>
                            )}

                            <div className="flex items-center space-x-4 text-sm text-gray-500">
                              <span className="flex items-center space-x-1">
                                <Calendar className="w-4 h-4" />
                                <span>期日: {task.dueDate}</span>
                              </span>
                              {assignee && (
                                <span className="flex items-center space-x-1">
                                  <User className="w-4 h-4" />
                                  <span>担当: {assignee.name}</span>
                                </span>
                              )}
                              <span className="flex items-center space-x-1">
                                <FileText className="w-4 h-4" />
                                <span>種別: {task.type}</span>
                              </span>
                            </div>

                            {task.amount && (
                              <div className="mt-3 pt-3 border-t border-gray-200">
                                <span className="text-sm text-gray-500">金額: </span>
                                <span className="text-lg font-bold text-gray-800">
                                  {Number(task.amount).toLocaleString()}円
                                </span>
                              </div>
                            )}
                          </div>

                          <ChevronRight className="w-6 h-6 text-gray-400" />
                        </div>
                      </div>
                    );
                  })}
                </div>

                {filteredTasks.length === 0 && (
                  <div className="bg-white rounded-xl p-12 text-center shadow-md">
                    <Clock className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                    <p className="text-gray-500 text-lg">該当するタスクがありません</p>
                  </div>
                )}
              </div>
            )}

            {/* 営業所管理 */}
            {view === 'offices' && (
              <div className="p-8 space-y-6">
                <div className="flex justify-between items-center">
                  <h2 className="text-3xl font-bold text-gray-800">営業所管理</h2>
                  <button
                    onClick={() => setShowAddOffice(true)}
                    className="bg-orange-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-orange-600 transition-colors flex items-center space-x-2 shadow-lg"
                  >
                    <Plus className="w-5 h-5" />
                    <span>営業所を追加</span>
                  </button>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  {offices.map(office => {
                    const officeStaff = staff.filter(s => s.officeId === office.id);
                    const officeContracts = contracts.filter(c => c.officeId === office.id);

                    return (
                      <div key={office.id} className="bg-white rounded-xl shadow-md p-6">
                        <div className="flex items-start justify-between mb-4">
                          <div>
                            <h3 className="text-xl font-bold text-gray-800">{office.name}</h3>
                            <p className="text-gray-600 text-sm mt-1">{office.address}</p>
                          </div>
                          <Building2 className="w-8 h-8 text-orange-500" />
                        </div>

                        <div className="space-y-3 pt-4 border-t border-gray-200">
                          <div className="flex items-center justify-between">
                            <span className="text-gray-600">スタッフ数</span>
                            <span className="font-bold text-gray-800">{officeStaff.length}名</span>
                          </div>
                          <div className="flex items-center justify-between">
                            <span className="text-gray-600">進行中の契約</span>
                            <span className="font-bold text-orange-600">{officeContracts.length}件</span>
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            {/* スタッフ管理 */}
            {view === 'staff' && (
              <div className="p-8 space-y-6">
                <div className="flex justify-between items-center">
                  <h2 className="text-3xl font-bold text-gray-800">スタッフ管理</h2>
                  <button
                    onClick={() => setShowAddStaff(true)}
                    className="bg-orange-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-orange-600 transition-colors flex items-center space-x-2 shadow-lg"
                  >
                    <Plus className="w-5 h-5" />
                    <span>スタッフを追加</span>
                  </button>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                  {staff.map(member => {
                    const office = offices.find(o => o.id === member.officeId);
                    const memberContracts = contracts.filter(c => c.assigneeId === member.id);

                    return (
                      <div key={member.id} className="bg-white rounded-xl shadow-md p-6">
                        <div className="flex items-start justify-between mb-4">
                          <div>
                            <h3 className="text-xl font-bold text-gray-800">{member.name}</h3>
                            <p className="text-gray-600 text-sm mt-1">{member.role}</p>
                            {office && <p className="text-gray-500 text-sm">{office.name}</p>}
                          </div>
                          <User className="w-8 h-8 text-blue-500" />
                        </div>

                        <div className="pt-4 border-t border-gray-200">
                          <div className="flex items-center justify-between">
                            <span className="text-gray-600">担当契約数</span>
                            <span className="font-bold text-gray-800">{memberContracts.length}件</span>
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}
          </div>

          {/* 🏠 物件追加モーダル */}
          {showNewProperty && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
                <div className="sticky top-0 bg-white border-b p-6 z-10">
                  <div className="flex items-center justify-between">
                    <div>
                      <h3 className="text-2xl font-bold text-gray-800">物件を追加</h3>
                      <p className="text-sm text-gray-500 mt-1">
                        ステップ {propertyStep} / {totalPropertySteps}
                      </p>
                    </div>
                    <button onClick={() => { setShowNewProperty(false); setPropertyStep(1); }} className="text-gray-400 hover:text-gray-600">
                      <X className="w-6 h-6" />
                    </button>
                  </div>
                  <div className="mt-4 flex space-x-2">
                    {[1, 2, 3, 4].map(step => (
                      <div
                        key={step}
                        className={`flex-1 h-2 rounded-full ${step <= propertyStep ? 'bg-orange-500' : 'bg-gray-200'}`}
                      />
                    ))}
                  </div>
                </div>

                <div className="p-6 space-y-6">
                  {propertyStep === 1 && (
                    <div className="space-y-4">
                      <h4 className="text-lg font-bold text-gray-800">基本情報</h4>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">物件種別 *</label>
                        <select
                          value={newProperty.propertyType}
                          onChange={(e) => setNewProperty({ ...newProperty, propertyType: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        >
                          <option>マンション</option>
                          <option>一戸建て</option>
                          <option>土地</option>
                          <option>店舗・事務所</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">物件名 *</label>
                        <input
                          type="text"
                          value={newProperty.propertyName}
                          onChange={(e) => setNewProperty({ ...newProperty, propertyName: e.target.value })}
                          placeholder="例: パークマンション渋谷"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        />
                      </div>
                    </div>
                  )}

                  {propertyStep === 2 && (
                    <div className="space-y-4">
                      <h4 className="text-lg font-bold text-gray-800">所在地情報</h4>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">住所 *</label>
                        <input
                          type="text"
                          value={newProperty.address}
                          onChange={(e) => setNewProperty({ ...newProperty, address: e.target.value })}
                          placeholder="例: 東京都渋谷区神宮前1-1-1"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        />
                      </div>
                      {newProperty.propertyType === 'マンション' && (
                        <div>
                          <label className="block text-sm font-semibold text-gray-700 mb-2">部屋番号</label>
                          <input
                            type="text"
                            value={newProperty.roomNumber}
                            onChange={(e) => setNewProperty({ ...newProperty, roomNumber: e.target.value })}
                            placeholder="例: 305"
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                          />
                        </div>
                      )}
                    </div>
                  )}

                  {propertyStep === 3 && (
                    <div className="space-y-4">
                      <h4 className="text-lg font-bold text-gray-800">物件詳細</h4>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">建物構造</label>
                        <select
                          value={newProperty.buildingStructure}
                          onChange={(e) => setNewProperty({ ...newProperty, buildingStructure: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        >
                          <option value="">選択してください</option>
                          <option>木造</option>
                          <option>鉄骨造</option>
                          <option>RC造</option>
                          <option>SRC造</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">築年</label>
                        <input
                          type="text"
                          value={newProperty.buildYear}
                          onChange={(e) => setNewProperty({ ...newProperty, buildYear: e.target.value })}
                          placeholder="例: 2015"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        />
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-semibold text-gray-700 mb-2">土地面積 (㎡)</label>
                          <input
                            type="text"
                            value={newProperty.landArea}
                            onChange={(e) => setNewProperty({ ...newProperty, landArea: e.target.value })}
                            placeholder="例: 100"
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-semibold text-gray-700 mb-2">建物面積 (㎡)</label>
                          <input
                            type="text"
                            value={newProperty.buildingArea}
                            onChange={(e) => setNewProperty({ ...newProperty, buildingArea: e.target.value })}
                            placeholder="例: 80"
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {propertyStep === 4 && (
                    <div className="space-y-4">
                      <h4 className="text-lg font-bold text-gray-800">備考</h4>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">備考・メモ</label>
                        <textarea
                          value={newProperty.notes}
                          onChange={(e) => setNewProperty({ ...newProperty, notes: e.target.value })}
                          placeholder="物件に関する補足情報を記入してください"
                          rows="6"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        />
                      </div>
                    </div>
                  )}
                </div>

                <div className="sticky bottom-0 bg-gray-50 px-6 py-4 flex justify-between border-t">
                  {propertyStep > 1 && (
                    <button
                      onClick={() => setPropertyStep(propertyStep - 1)}
                      className="px-6 py-2 border border-gray-300 rounded-lg font-semibold text-gray-700 hover:bg-gray-100 transition-colors"
                    >
                      戻る
                    </button>
                  )}
                  {propertyStep < totalPropertySteps && (
                    <button
                      onClick={() => setPropertyStep(propertyStep + 1)}
                      className="ml-auto px-6 py-2 bg-orange-500 text-white rounded-lg font-semibold hover:bg-orange-600 transition-colors"
                    >
                      次へ
                    </button>
                  )}
                  {propertyStep === totalPropertySteps && (
                    <button
                      onClick={handleAddProperty}
                      className="ml-auto px-6 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition-colors"
                    >
                      物件を追加
                    </button>
                  )}
                </div>
              </div>
            </div>
          )}

          {/* 🏠 物件編集モーダル */}
          {showEditProperty && editingProperty && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
                <div className="sticky top-0 bg-white border-b p-6 z-10">
                  <div className="flex items-center justify-between">
                    <div>
                      <h3 className="text-2xl font-bold text-gray-800">物件を編集</h3>
                      <p className="text-sm text-gray-500 mt-1">
                        ステップ {editPropertyStep} / {totalPropertySteps}
                      </p>
                    </div>
                    <button onClick={() => { setShowEditProperty(false); setEditPropertyStep(1); }} className="text-gray-400 hover:text-gray-600">
                      <X className="w-6 h-6" />
                    </button>
                  </div>
                  <div className="mt-4 flex space-x-2">
                    {[1, 2, 3, 4].map(step => (
                      <div
                        key={step}
                        className={`flex-1 h-2 rounded-full ${step <= editPropertyStep ? 'bg-orange-500' : 'bg-gray-200'}`}
                      />
                    ))}
                  </div>
                </div>

                <div className="p-6 space-y-6">
                  {editPropertyStep === 1 && (
                    <div className="space-y-4">
                      <h4 className="text-lg font-bold text-gray-800">基本情報</h4>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">物件種別 *</label>
                        <select
                          value={editingProperty.propertyType}
                          onChange={(e) => setEditingProperty({ ...editingProperty, propertyType: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        >
                          <option>マンション</option>
                          <option>一戸建て</option>
                          <option>土地</option>
                          <option>店舗・事務所</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">物件名 *</label>
                        <input
                          type="text"
                          value={editingProperty.propertyName}
                          onChange={(e) => setEditingProperty({ ...editingProperty, propertyName: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        />
                      </div>
                    </div>
                  )}

                  {editPropertyStep === 2 && (
                    <div className="space-y-4">
                      <h4 className="text-lg font-bold text-gray-800">所在地情報</h4>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">住所 *</label>
                        <input
                          type="text"
                          value={editingProperty.address}
                          onChange={(e) => setEditingProperty({ ...editingProperty, address: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        />
                      </div>
                      {editingProperty.propertyType === 'マンション' && (
                        <div>
                          <label className="block text-sm font-semibold text-gray-700 mb-2">部屋番号</label>
                          <input
                            type="text"
                            value={editingProperty.roomNumber}
                            onChange={(e) => setEditingProperty({ ...editingProperty, roomNumber: e.target.value })}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                          />
                        </div>
                      )}
                    </div>
                  )}

                  {editPropertyStep === 3 && (
                    <div className="space-y-4">
                      <h4 className="text-lg font-bold text-gray-800">物件詳細</h4>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">建物構造</label>
                        <select
                          value={editingProperty.buildingStructure}
                          onChange={(e) => setEditingProperty({ ...editingProperty, buildingStructure: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        >
                          <option value="">選択してください</option>
                          <option>木造</option>
                          <option>鉄骨造</option>
                          <option>RC造</option>
                          <option>SRC造</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">築年</label>
                        <input
                          type="text"
                          value={editingProperty.buildYear}
                          onChange={(e) => setEditingProperty({ ...editingProperty, buildYear: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        />
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-semibold text-gray-700 mb-2">土地面積 (㎡)</label>
                          <input
                            type="text"
                            value={editingProperty.landArea}
                            onChange={(e) => setEditingProperty({ ...editingProperty, landArea: e.target.value })}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-semibold text-gray-700 mb-2">建物面積 (㎡)</label>
                          <input
                            type="text"
                            value={editingProperty.buildingArea}
                            onChange={(e) => setEditingProperty({ ...editingProperty, buildingArea: e.target.value })}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {editPropertyStep === 4 && (
                    <div className="space-y-4">
                      <h4 className="text-lg font-bold text-gray-800">備考</h4>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">備考・メモ</label>
                        <textarea
                          value={editingProperty.notes}
                          onChange={(e) => setEditingProperty({ ...editingProperty, notes: e.target.value })}
                          rows="6"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        />
                      </div>
                    </div>
                  )}
                </div>

                <div className="sticky bottom-0 bg-gray-50 px-6 py-4 flex justify-between border-t">
                  {editPropertyStep > 1 && (
                    <button
                      onClick={() => setEditPropertyStep(editPropertyStep - 1)}
                      className="px-6 py-2 border border-gray-300 rounded-lg font-semibold text-gray-700 hover:bg-gray-100 transition-colors"
                    >
                      戻る
                    </button>
                  )}
                  {editPropertyStep < totalPropertySteps && (
                    <button
                      onClick={() => setEditPropertyStep(editPropertyStep + 1)}
                      className="ml-auto px-6 py-2 bg-orange-500 text-white rounded-lg font-semibold hover:bg-orange-600 transition-colors"
                    >
                      次へ
                    </button>
                  )}
                  {editPropertyStep === totalPropertySteps && (
                    <button
                      onClick={handleEditProperty}
                      className="ml-auto px-6 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition-colors"
                    >
                      更新
                    </button>
                  )}
                </div>
              </div>
            </div>
          )}

          {/* 契約追加モーダル（7ステップ） */}
          {showNewContract && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto">
              <div className="bg-white rounded-2xl shadow-2xl w-full max-w-4xl my-8">
                <div className="sticky top-0 bg-white border-b p-6 z-10 rounded-t-2xl">
                  <div className="flex items-center justify-between">
                    <div>
                      <h3 className="text-2xl font-bold text-gray-800">契約を追加</h3>
                      <p className="text-sm text-gray-500 mt-1">ステップ {currentStep} / {totalSteps}</p>
                    </div>
                    <button onClick={() => { setShowNewContract(false); setCurrentStep(1); }} className="text-gray-400 hover:text-gray-600">
                      <X className="w-6 h-6" />
                    </button>
                  </div>
                  <div className="mt-4 flex space-x-1">
                    {[1, 2, 3, 4, 5, 6, 7].map(step => (
                      <div key={step} className={`flex-1 h-2 rounded-full ${step <= currentStep ? 'bg-orange-500' : 'bg-gray-200'}`} />
                    ))}
                  </div>
                </div>

                <div className="p-6 space-y-6 max-h-[60vh] overflow-y-auto">
                  {currentStep === 1 && (
                    <div className="space-y-4">
                      <h4 className="text-lg font-bold text-gray-800">物件情報</h4>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">既存物件から選択（任意）</label>
                        <select
                          value={newContract.propertyId}
                          onChange={(e) => {
                            const propId = Number(e.target.value);
                            const prop = properties.find(p => p.id === propId);
                            if (prop) {
                              setNewContract({
                                ...newContract,
                                propertyId: propId,
                                propertyType: prop.propertyType,
                                address: prop.address,
                                propertyName: prop.propertyName,
                                roomNumber: prop.roomNumber || ''
                              });
                            } else {
                              setNewContract({ ...newContract, propertyId: '' });
                            }
                          }}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                        >
                          <option value="">新規物件として入力</option>
                          {properties.map(prop => (
                            <option key={prop.id} value={prop.id}>
                              {prop.propertyName} {prop.roomNumber} - {prop.address}
                            </option>
                          ))}
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">物件種別 *</label>
                        <select
                          value={newContract.propertyType}
                          onChange={(e) => setNewContract({ ...newContract, propertyType: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                        >
                          <option>マンション</option>
                          <option>一戸建て</option>
                          <option>土地</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">住所 *</label>
                        <input
                          type="text"
                          value={newContract.address}
                          onChange={(e) => setNewContract({ ...newContract, address: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                        />
                      </div>
                      {newContract.propertyType === 'マンション' && (
                        <>
                          <div>
                            <label className="block text-sm font-semibold text-gray-700 mb-2">物件名</label>
                            <input
                              type="text"
                              value={newContract.propertyName}
                              onChange={(e) => setNewContract({ ...newContract, propertyName: e.target.value })}
                              className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-semibold text-gray-700 mb-2">部屋番号</label>
                            <input
                              type="text"
                              value={newContract.roomNumber}
                              onChange={(e) => setNewContract({ ...newContract, roomNumber: e.target.value })}
                              className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                            />
                          </div>
                        </>
                      )}
                    </div>
                  )}

                  {currentStep === 2 && (
                    <div className="space-y-4">
                      <h4 className="text-lg font-bold text-gray-800">取引情報</h4>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">取引種別 *</label>
                        <select
                          value={newContract.dealType}
                          onChange={(e) => setNewContract({ ...newContract, dealType: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                        >
                          <option>仲介</option>
                          <option>買取</option>
                          <option>売却</option>
                        </select>
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-semibold text-gray-700 mb-2">買主名</label>
                          <input
                            type="text"
                            value={newContract.buyerName}
                            onChange={(e) => setNewContract({ ...newContract, buyerName: e.target.value })}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-semibold text-gray-700 mb-2">買主名（カナ）</label>
                          <input
                            type="text"
                            value={newContract.buyerKana}
                            onChange={(e) => setNewContract({ ...newContract, buyerKana: e.target.value })}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                          />
                        </div>
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-semibold text-gray-700 mb-2">売主名</label>
                          <input
                            type="text"
                            value={newContract.sellerName}
                            onChange={(e) => setNewContract({ ...newContract, sellerName: e.target.value })}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-semibold text-gray-700 mb-2">売主名（カナ）</label>
                          <input
                            type="text"
                            value={newContract.sellerKana}
                            onChange={(e) => setNewContract({ ...newContract, sellerKana: e.target.value })}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {currentStep === 3 && (
                    <div className="space-y-4">
                      <h4 className="text-lg font-bold text-gray-800">金額情報</h4>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">物件価格（円）</label>
                        <input
                          type="number"
                          value={newContract.propertyPrice}
                          onChange={(e) => setNewContract({ ...newContract, propertyPrice: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">残債務（円）</label>
                        <input
                          type="number"
                          value={newContract.outstandingDebt}
                          onChange={(e) => setNewContract({ ...newContract, outstandingDebt: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                        />
                      </div>
                    </div>
                  )}

                  {currentStep === 4 && (
                    <div className="space-y-4">
                      <h4 className="text-lg font-bold text-gray-800">特記事項</h4>
                      <div className="space-y-3">
                        <label className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            checked={newContract.loanUsage}
                            onChange={(e) => setNewContract({ ...newContract, loanUsage: e.target.checked })}
                            className="w-5 h-5"
                          />
                          <span>ローン利用</span>
                        </label>
                        <label className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            checked={newContract.mortgageRemoval}
                            onChange={(e) => setNewContract({ ...newContract, mortgageRemoval: e.target.checked })}
                            className="w-5 h-5"
                          />
                          <span>抵当権抹消</span>
                        </label>
                        <label className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            checked={newContract.renovation}
                            onChange={(e) => setNewContract({ ...newContract, renovation: e.target.checked })}
                            className="w-5 h-5"
                          />
                          <span>リフォーム</span>
                        </label>
                      </div>
                    </div>
                  )}

                  {currentStep === 5 && (
                    <div className="space-y-4">
                      <h4 className="text-lg font-bold text-gray-800">日程</h4>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">契約日</label>
                        <input
                          type="date"
                          value={newContract.contractDate}
                          onChange={(e) => setNewContract({ ...newContract, contractDate: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">決済期限</label>
                        <input
                          type="date"
                          value={newContract.settlementDeadline}
                          onChange={(e) => setNewContract({ ...newContract, settlementDeadline: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                        />
                      </div>
                    </div>
                  )}

                  {currentStep === 6 && (
                    <div className="space-y-4">
                      <h4 className="text-lg font-bold text-gray-800">担当者情報</h4>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">営業所</label>
                        <select
                          value={newContract.officeId}
                          onChange={(e) => setNewContract({ ...newContract, officeId: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                        >
                          <option value="">選択してください</option>
                          {offices.map(office => (
                            <option key={office.id} value={office.id}>{office.name}</option>
                          ))}
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">担当者</label>
                        <select
                          value={newContract.assigneeId}
                          onChange={(e) => setNewContract({ ...newContract, assigneeId: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                        >
                          <option value="">選択してください</option>
                          {staff.map(member => (
                            <option key={member.id} value={member.id}>{member.name}</option>
                          ))}
                        </select>
                      </div>
                    </div>
                  )}

                  {currentStep === 7 && (
                    <div className="space-y-4">
                      <h4 className="text-lg font-bold text-gray-800">確認</h4>
                      <div className="bg-gray-50 p-4 rounded-lg space-y-2 text-sm">
                        <div><span className="font-semibold">物件種別:</span> {newContract.propertyType}</div>
                        <div><span className="font-semibold">住所:</span> {newContract.address}</div>
                        <div><span className="font-semibold">取引種別:</span> {newContract.dealType}</div>
                        <div><span className="font-semibold">買主:</span> {newContract.buyerName}</div>
                        <div><span className="font-semibold">売主:</span> {newContract.sellerName}</div>
                        <div><span className="font-semibold">契約日:</span> {newContract.contractDate}</div>
                        <div><span className="font-semibold">決済期限:</span> {newContract.settlementDeadline}</div>
                      </div>
                    </div>
                  )}
                </div>

                <div className="sticky bottom-0 bg-gray-50 px-6 py-4 flex justify-between border-t rounded-b-2xl">
                  {currentStep > 1 && (
                    <button
                      onClick={() => setCurrentStep(currentStep - 1)}
                      className="px-6 py-2 border border-gray-300 rounded-lg font-semibold text-gray-700 hover:bg-gray-100"
                    >
                      戻る
                    </button>
                  )}
                  {currentStep < totalSteps && (
                    <button
                      onClick={() => setCurrentStep(currentStep + 1)}
                      className="ml-auto px-6 py-2 bg-orange-500 text-white rounded-lg font-semibold hover:bg-orange-600"
                    >
                      次へ
                    </button>
                  )}
                  {currentStep === totalSteps && (
                    <button
                      onClick={handleAddContract}
                      className="ml-auto px-6 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600"
                    >
                      契約を追加
                    </button>
                  )}
                </div>
              </div>
            </div>
          )}

          {/* 契約編集モーダル */}
          {showEditContract && editingContract && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto">
              <div className="bg-white rounded-2xl shadow-2xl w-full max-w-4xl my-8">
                <div className="sticky top-0 bg-white border-b p-6 z-10 rounded-t-2xl">
                  <div className="flex items-center justify-between">
                    <h3 className="text-2xl font-bold text-gray-800">契約を編集</h3>
                    <button onClick={() => { setShowEditContract(false); setEditStep(1); }} className="text-gray-400 hover:text-gray-600">
                      <X className="w-6 h-6" />
                    </button>
                  </div>
                </div>

                <div className="p-6 space-y-6">
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">住所 *</label>
                      <input
                        type="text"
                        value={editingContract.address}
                        onChange={(e) => setEditingContract({ ...editingContract, address: e.target.value })}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">取引種別 *</label>
                      <select
                        value={editingContract.dealType}
                        onChange={(e) => setEditingContract({ ...editingContract, dealType: e.target.value })}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                      >
                        <option>仲介</option>
                        <option>買取</option>
                        <option>売却</option>
                      </select>
                    </div>
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">買主名</label>
                        <input
                          type="text"
                          value={editingContract.buyerName}
                          onChange={(e) => setEditingContract({ ...editingContract, buyerName: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">売主名</label>
                        <input
                          type="text"
                          value={editingContract.sellerName}
                          onChange={(e) => setEditingContract({ ...editingContract, sellerName: e.target.value })}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                        />
                      </div>
                    </div>
                  </div>
                </div>

                <div className="sticky bottom-0 bg-gray-50 px-6 py-4 flex justify-end space-x-3 border-t rounded-b-2xl">
                  <button
                    onClick={() => setShowEditContract(false)}
                    className="px-6 py-2 border border-gray-300 rounded-lg font-semibold text-gray-700 hover:bg-gray-100"
                  >
                    キャンセル
                  </button>
                  <button
                    onClick={handleEditContractSave}
                    className="px-6 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600"
                  >
                    更新
                  </button>
                </div>
              </div>
            </div>
          )}

          {showPaymentDetail && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-2xl shadow-2xl w-full max-w-2xl">
                <div className="border-b p-6">
                  <div className="flex items-center justify-between">
                    <h3 className="text-2xl font-bold text-gray-800">{showPaymentDetail.title}</h3>
                    <button onClick={() => setShowPaymentDetail(null)} className="text-gray-400">
                      <X className="w-6 h-6" />
                    </button>
                  </div>
                </div>
                <div className="p-6">
                  {(() => {
                    const contract = contracts.find(c => c.id === showPaymentDetail.contractId);
                    return (
                      <div className="space-y-6">
                        {contract && (
                          <div className="bg-gray-50 p-4 rounded-lg">
                            <div className="font-semibold text-gray-700 mb-2">契約情報</div>
                            <div className="text-sm text-gray-600">
                              {contract.propertyName} {contract.roomNumber}
                            </div>
                            <div className="text-sm text-gray-600">{contract.address}</div>
                          </div>
                        )}

                        <div className="grid grid-cols-2 gap-6">
                          <div>
                            <div className="text-gray-600 mb-1">タスク種別</div>
                            <div className={`inline-block px-4 py-2 rounded-lg font-semibold ${
                              showPaymentDetail.type === '入金' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'
                            }`}>
                              {showPaymentDetail.type}
                            </div>
                          </div>
                          <div>
                            <div className="text-gray-600 mb-1">期日</div>
                            <div className="font-semibold text-gray-800">{showPaymentDetail.dueDate}</div>
                          </div>
                        </div>

                        {showPaymentDetail.amount && (
                          <div className="bg-blue-50 p-6 rounded-lg">
                            <div className="text-gray-600 mb-2">金額</div>
                            <div className="text-3xl font-bold text-blue-600">
                              ¥{Number(showPaymentDetail.amount).toLocaleString()}
                            </div>
                          </div>
                        )}

                        {(showPaymentDetail.purpose || showPaymentDetail.paymentMethod || showPaymentDetail.receiptDelivery) && (
                          <div className="border-t pt-6">
                            <div className="grid grid-cols-2 gap-4">
                              {showPaymentDetail.purpose && (
                                <div>
                                  <div className="text-gray-600 mb-1">用途</div>
                                  <div className="font-semibold text-gray-800">{showPaymentDetail.purpose}</div>
                                </div>
                              )}
                              {showPaymentDetail.paymentMethod && (
                                <div>
                                  <div className="text-gray-600 mb-1">支払方法</div>
                                  <div className="font-semibold text-gray-800">{showPaymentDetail.paymentMethod}</div>
                                </div>
                              )}
                              {showPaymentDetail.receiptDelivery && (
                                <div>
                                  <div className="text-gray-600 mb-1">領収書配送</div>
                                  <div className="font-semibold text-gray-800">{showPaymentDetail.receiptDelivery}</div>
                                </div>
                              )}
                            </div>
                          </div>
                        )}

                        <div className="flex justify-end space-x-3 pt-4 border-t border-gray-200">
                          {!showPaymentDetail.paymentCompleted && (
                            <button
                              onClick={() => handlePaymentComplete(showPaymentDetail.id, showPaymentDetail.type)}
                              className={`${showPaymentDetail.type === '入金' ? 'bg-green-500 hover:bg-green-600' : 'bg-red-500 hover:bg-red-600'} px-6 py-3 rounded-lg font-semibold transition-all flex items-center space-x-2 text-white`}
                            >
                              <Check className="w-5 h-5" />
                              <span>経理{showPaymentDetail.type === '入金' ? '入金' : '支払い'}確認</span>
                            </button>
                          )}
                          {showPaymentDetail.paymentCompleted && (
                            <div className="px-6 py-3 bg-gray-100 text-gray-600 rounded-lg font-semibold flex items-center space-x-2">
                              <Check className="w-5 h-5" />
                              <span>確認済み</span>
                            </div>
                          )}
                          <button
                            onClick={() => setShowPaymentDetail(null)}
                            className="px-6 py-2 bg-gray-500 text-white rounded-lg font-semibold hover:bg-gray-600 transition-colors"
                          >
                            閉じる
                          </button>
                        </div>
                      </div>
                    );
                  })()}
                </div>
              </div>
            </div>
          )}

          {showTaskDetail && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-2xl shadow-2xl w-full max-w-2xl">
                <div className="border-b p-6">
                  <div className="flex items-center justify-between">
                    <h3 className="text-2xl font-bold text-gray-800">{showTaskDetail.title}</h3>
                    <button onClick={() => setShowTaskDetail(null)} className="text-gray-400">
                      <X className="w-6 h-6" />
                    </button>
                  </div>
                </div>
                <div className="p-6">
                  <div className="space-y-4">
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-1">タスク種別</label>
                        <div className="text-gray-800">{showTaskDetail.type}</div>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-1">期日</label>
                        <div className="text-gray-800">{showTaskDetail.dueDate}</div>
                      </div>
                    </div>
                    <div className="flex space-x-3 pt-4">
                      <button onClick={() => { updateTaskStatus(showTaskDetail.id, 'in-progress'); setShowTaskDetail(null); }} className="flex-1 bg-blue-500 text-white py-3 rounded-lg font-semibold">担当者確認</button>
                      <button onClick={() => { updateTaskStatus(showTaskDetail.id, 'done'); setShowTaskDetail(null); }} className="flex-1 bg-green-500 text-white py-3 rounded-lg font-semibold">完了</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          )}

          {showAddOffice && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md">
                <div className="border-b p-6">
                  <div className="flex items-center justify-between">
                    <h3 className="text-2xl font-bold text-gray-800">営業所を追加</h3>
                    <button onClick={() => setShowAddOffice(false)} className="text-gray-400">
                      <X className="w-6 h-6" />
                    </button>
                  </div>
                </div>
                <div className="p-6 space-y-4">
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">営業所名 *</label>
                    <input type="text" value={newOffice.name} onChange={(e) => setNewOffice({ ...newOffice, name: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                  </div>
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">住所 *</label>
                    <input type="text" value={newOffice.address} onChange={(e) => setNewOffice({ ...newOffice, address: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                  </div>
                  <div className="flex justify-end space-x-3 pt-4">
                    <button onClick={() => setShowAddOffice(false)} className="px-6 py-2 border rounded-lg text-gray-700">キャンセル</button>
                    <button onClick={handleAddOffice} className="px-6 py-2 bg-orange-500 text-white rounded-lg font-semibold">追加</button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {showAddStaff && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md">
                <div className="border-b p-6">
                  <div className="flex items-center justify-between">
                    <h3 className="text-2xl font-bold text-gray-800">スタッフを追加</h3>
                    <button onClick={() => setShowAddStaff(false)} className="text-gray-400">
                      <X className="w-6 h-6" />
                    </button>
                  </div>
                </div>
                <div className="p-6 space-y-4">
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">名前 *</label>
                    <input type="text" value={newStaff.name} onChange={(e) => setNewStaff({ ...newStaff, name: e.target.value })} className="w-full px-4 py-2 border rounded-lg" />
                  </div>
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">営業所 *</label>
                    <select value={newStaff.officeId} onChange={(e) => setNewStaff({ ...newStaff, officeId: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                      <option value="">選択してください</option>
                      {offices.map(office => (
                        <option key={office.id} value={office.id}>{office.name}</option>
                      ))}
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">役職</label>
                    <select value={newStaff.role} onChange={(e) => setNewStaff({ ...newStaff, role: e.target.value })} className="w-full px-4 py-2 border rounded-lg">
                      <option value="営業担当">営業担当</option>
                      <option value="所長">所長</option>
                      <option value="経理">経理</option>
                    </select>
                  </div>
                  <div className="flex justify-end space-x-3 pt-4">
                    <button onClick={() => setShowAddStaff(false)} className="px-6 py-2 border rounded-lg text-gray-700">キャンセル</button>
                    <button onClick={handleAddStaff} className="px-6 py-2 bg-blue-500 text-white rounded-lg font-semibold">追加</button>
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<RealEstateTaskManager />);
  </script>
</body>
</html>
