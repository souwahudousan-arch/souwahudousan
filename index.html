<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ä¸å‹•ç”£å¥‘ç´„é€²æ—ç®¡ç†ï¼ˆã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ï¼‰</title>

  <!-- React 18 UMD -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

  <!-- Babel (ãƒ–ãƒ©ã‚¦ã‚¶ã§JSXå¤‰æ›ç”¨) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- TailwindCSSï¼ˆCDNï¼‰ -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>

  <style>
    body { background: #f7fafc; font-feature-settings: "palt" 1; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    // ====== lucide-react ã®ä»£æ›¿ï¼šç°¡æ˜“SVGã‚¢ã‚¤ã‚³ãƒ³ ======
    const makeIcon = (label) => ({ className = "w-5 h-5", ...rest }) => (
      <svg
        className={className}
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
        aria-label={label}
        {...rest}
      >
        <rect x="3" y="3" width="18" height="18" rx="4" ry="4"></rect>
        <text x="12" y="15" textAnchor="middle" fontSize="8" fontFamily="sans-serif">
          {label?.[0] || "I"}
        </text>
      </svg>
    );

    const Bell = makeIcon('Bell');
    const Plus = makeIcon('Plus');
    const X = makeIcon('X');
    const Calendar = makeIcon('Cal');
    const User = makeIcon('User');
    const Building2 = makeIcon('Bld');
    const AlertCircle = makeIcon('!');
    const Check = makeIcon('OK');
    const Clock = makeIcon('Clk');
    const ChevronRight = makeIcon('>');
    const Users = makeIcon('Usr');
    const MapPin = makeIcon('Pin');
    const Briefcase = makeIcon('Job');
    const DollarSign = makeIcon('Â¥');
    const FileText = makeIcon('Doc');
    const Upload = makeIcon('Up');
    const TrendingUp = makeIcon('UpT');
    const BarChart3 = makeIcon('Bar');
    const Search = makeIcon('Srch');
    const Filter = makeIcon('Fltr');
    const Download = makeIcon('DL');
    const Edit2 = makeIcon('Edt');
    const Save = makeIcon('Sav');
    const LayoutDashboard = makeIcon('Dsh');
    const PieChart = makeIcon('Pie');

    // ====== Reactæœ¬ä½“ ======
    const { useState, useMemo } = React;

    const RealEstateTaskManager = () => {
      const [view, setView] = useState('dashboard');
      const [selectedContract, setSelectedContract] = useState(1);
      const [showNewContract, setShowNewContract] = useState(false);
      const [showEditContract, setShowEditContract] = useState(false);
      const [editingContract, setEditingContract] = useState(null);
      const [editContractTab, setEditContractTab] = useState('basic');
      const [showTaskDetail, setShowTaskDetail] = useState(null);
      const [isEditingTask, setIsEditingTask] = useState(false);
      const [editedTask, setEditedTask] = useState(null);
      const [showPaymentDetail, setShowPaymentDetail] = useState(null);

      const [salesPeriodType, setSalesPeriodType] = useState('month');
      const [salesYear, setSalesYear] = useState(2025);
      const [salesMonth, setSalesMonth] = useState(10);

      const [currentStep, setCurrentStep] = useState(1);
      const [editStep, setEditStep] = useState(1);
      const totalSteps = 7;

      const [searchQuery, setSearchQuery] = useState('');
      const [priorityFilter, setPriorityFilter] = useState('all');
      const [typeFilter, setTypeFilter] = useState('all');
      const [statusFilter, setStatusFilter] = useState('all');
      const [dateFilter, setDateFilter] = useState('all');
      const [showFilters, setShowFilters] = useState(false);
      const [officeFilter, setOfficeFilter] = useState('all');

      // ğŸ”§ è¿½åŠ ï¼šãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºç”¨ stateï¼ˆæœªå®šç¾©ã‚¨ãƒ©ãƒ¼ã®åŸå› ï¼‰
      const [showAddOffice, setShowAddOffice] = useState(false);
      const [showAddStaff, setShowAddStaff] = useState(false);

      const [newContract, setNewContract] = useState({
        propertyType: 'ãƒãƒ³ã‚·ãƒ§ãƒ³', address: '', propertyName: '', roomNumber: '',
        dealType: 'ä»²ä»‹', buyerName: '', buyerKana: '', sellerName: '', sellerKana: '',
        propertyPrice: '', outstandingDebt: '', consumptionTax: '', loanUsage: false,
        loanApprovalDate: '', mortgageRemoval: false, arrears: false, demolition: false,
        renovation: false, survey: false, contractDate: '', settlementDeadline: '',
        confirmedSettlementDate: '', officeId: '', assigneeId: '',
        manualRevenue: '',
        buyerPaymentEnabled: false, buyerPaymentSplit: false,
        buyerPayments: [{ category: 'ä»²ä»‹æ‰‹æ•°æ–™', amount: '', dueDate: '', method: 'æŒ¯è¾¼', receipt: 'éƒµé€' }],
        sellerPaymentEnabled: false, sellerPaymentSplit: false,
        sellerPayments: [{ category: 'ä»²ä»‹æ‰‹æ•°æ–™', amount: '', dueDate: '', method: 'æŒ¯è¾¼', receipt: 'éƒµé€' }],
        vendor1PaymentEnabled: false,
        vendor1Payments: [{ category: 'ç´¹ä»‹æ–™', amount: '', dueDate: '', method: 'æŒ¯è¾¼', receipt: 'éƒµé€' }],
        vendor2PaymentEnabled: false,
        vendor2Payments: [{ category: 'ç´¹ä»‹æ–™', amount: '', dueDate: '', method: 'æŒ¯è¾¼', receipt: 'éƒµé€' }],
        vendor3PaymentEnabled: false,
        vendor3Payments: [{ category: 'ç´¹ä»‹æ–™', amount: '', dueDate: '', method: 'æŒ¯è¾¼', receipt: 'éƒµé€' }],
        buyerExpenseEnabled: false,
        buyerExpenses: [{ category: 'è¿”é‡‘', amount: '', dueDate: '', accountImages: [] }],
        sellerExpenseEnabled: false,
        sellerExpenses: [{ category: 'æ‰‹ä»˜é‡‘', amount: '', dueDate: '', accountImages: [] }],
        vendor1ExpenseEnabled: false,
        vendor1Expenses: [{ category: 'ä»²ä»‹æ‰‹æ•°æ–™', amount: '', dueDate: '', accountImages: [] }],
        vendor2ExpenseEnabled: false,
        vendor2Expenses: [{ category: 'ä»²ä»‹æ‰‹æ•°æ–™', amount: '', dueDate: '', accountImages: [] }],
        vendor3ExpenseEnabled: false,
        vendor3Expenses: [{ category: 'ä»²ä»‹æ‰‹æ•°æ–™', amount: '', dueDate: '', accountImages: [] }]
      });

      const [contracts, setContracts] = useState([
        {
          id: 1, propertyType: 'ãƒãƒ³ã‚·ãƒ§ãƒ³', address: 'æ±äº¬éƒ½æ¸‹è°·åŒºç¥å®®å‰1-1-1',
          propertyName: 'ãƒ‘ãƒ¼ã‚¯ãƒãƒ³ã‚·ãƒ§ãƒ³æ¸‹è°·', roomNumber: '305', dealType: 'ä»²ä»‹',
          buyerName: 'ç”°ä¸­å¤ªéƒ', buyerKana: 'ã‚¿ãƒŠã‚«ã‚¿ãƒ­ã‚¦', sellerName: 'å±±ç”°æ¬¡éƒ',
          sellerKana: 'ãƒ¤ãƒãƒ€ã‚¸ãƒ­ã‚¦', propertyPrice: 50000000, outstandingDebt: 30000000,
          consumptionTax: 0, manualRevenue: 0, loanUsage: true, loanApprovalDate: '2025-11-10',
          mortgageRemoval: true, arrears: false, demolition: false, renovation: true,
          survey: false, contractDate: '2025-10-15', settlementDeadline: '2025-11-30',
          confirmedSettlementDate: '', assigneeId: 1, officeId: 1, status: 'å¥‘ç´„æº–å‚™ä¸­', progress: 30,
          buyerPayments: [], sellerPayments: [], vendor1Payments: [], vendor2Payments: [], vendor3Payments: [],
          buyerExpenses: [], sellerExpenses: [], vendor1Expenses: [], vendor2Expenses: [], vendor3Expenses: []
        }
      ]);

      const [tasks, setTasks] = useState([
        { id: 1, contractId: 1, type: 'å…¥é‡‘', title: 'è²·ä¸»ã‹ã‚‰ä»²ä»‹æ‰‹æ•°æ–™å…¥é‡‘', amount: 1500000, purpose: 'ä»²ä»‹æ‰‹æ•°æ–™', paymentMethod: 'æŒ¯è¾¼', receiptDelivery: 'éƒµé€', dueDate: '2025-11-30', status: 'pending', assigneeId: 1, priority: 'high', paymentCompleted: false },
        { id: 2, contractId: 1, type: 'æŠµå½“æ¨©æŠ¹æ¶ˆ', title: 'æŠµå½“æ¨©æŠ¹æ¶ˆäº‹å‰æ‰‹ç¶šã', dueDate: '2025-10-30', status: 'in-progress', assigneeId: 1, priority: 'high', paymentCompleted: false },
        { id: 3, contractId: 1, type: 'è²·ä¸»èè³‡ç®¡ç†', title: 'èè³‡æ‰¿èªæ‰‹ç¶šã', dueDate: '2025-11-09', status: 'pending', assigneeId: 1, priority: 'high', paymentCompleted: false },
        { id: 4, contractId: 1, type: 'ãƒªãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†', title: 'ãƒªãƒ•ã‚©ãƒ¼ãƒ æ‰‹é…', dueDate: '2025-10-30', status: 'pending', assigneeId: 1, priority: 'medium', paymentCompleted: false },
        { id: 5, contractId: 1, type: 'åå…¥å°ç´™æ‰‹é…', title: 'è²·ä¸» åå…¥å°ç´™æ‰‹é…', stampAmount: 20000, dueDate: '2025-11-28', status: 'done', assigneeId: 1, priority: 'high', party: 'è²·ä¸»', paymentCompleted: false },
        { id: 6, contractId: 1, type: 'åå…¥å°ç´™æ‰‹é…', title: 'å£²ä¸» åå…¥å°ç´™æ‰‹é…', stampAmount: 20000, dueDate: '2025-11-28', status: 'pending', assigneeId: 1, priority: 'high', party: 'å£²ä¸»', paymentCompleted: false }
      ]);

      // ==== å–¶æ¥­æ‰€ãƒ»ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†ï¼ˆç´ã¥ã‘å¯¾å¿œï¼‰ ====
      const [offices, setOffices] = useState([
        {
          id: 1,
          name: 'æ¸‹è°·å–¶æ¥­æ‰€',
          address: 'æ±äº¬éƒ½æ¸‹è°·åŒº',
          staff: [
            { id: 1, name: 'å±±ç”°èŠ±å­', role: 'å–¶æ¥­æ‹…å½“' },
            { id: 2, name: 'éˆ´æœ¨ä¸€éƒ', role: 'å–¶æ¥­æ‹…å½“' }
          ]
        },
        {
          id: 2,
          name: 'æ–°å®¿å–¶æ¥­æ‰€',
          address: 'æ±äº¬éƒ½æ–°å®¿åŒº',
          staff: [
            { id: 3, name: 'ç”°ä¸­æ¬¡éƒ', role: 'æ‰€é•·' },
            { id: 4, name: 'ä½è—¤ç¾å’²', role: 'çµŒç†' }
          ]
        }
      ]);

      const [newOffice, setNewOffice] = useState({ name: '', address: '' });
      const [newStaff, setNewStaff] = useState({ name: '', role: 'å–¶æ¥­æ‹…å½“', officeId: null });

      // å–¶æ¥­æ‰€è¿½åŠ 
      const addOffice = () => {
        if (!newOffice.name.trim() || !newOffice.address.trim()) return;
        const newId = offices.length ? Math.max(...offices.map(o => o.id)) + 1 : 1;
        setOffices([...offices, { id: newId, ...newOffice, staff: [] }]);
        setNewOffice({ name: '', address: '' });
      };

      // å–¶æ¥­æ‰€å‰Šé™¤
      const removeOffice = (id) => {
        if (confirm('ã“ã®å–¶æ¥­æ‰€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
          setOffices(offices.filter(o => o.id !== id));
        }
      };

      // ã‚¹ã‚¿ãƒƒãƒ•è¿½åŠ ï¼ˆå–¶æ¥­æ‰€ã«ç´ã¥ã‘ï¼‰
      const addStaff = () => {
        if (!newStaff.name.trim() || !newStaff.officeId) return;
        const updatedOffices = offices.map(o => {
          if (o.id === parseInt(newStaff.officeId)) {
            const newId = o.staff.length > 0 ? Math.max(...o.staff.map(s => s.id)) + 1 : 1;
            return { ...o, staff: [...o.staff, { id: newId, name: newStaff.name, role: newStaff.role }] };
          }
          return o;
        });
        setOffices(updatedOffices);
        setNewStaff({ name: '', role: 'å–¶æ¥­æ‹…å½“', officeId: null });
      };

      // ã‚¹ã‚¿ãƒƒãƒ•å‰Šé™¤
      const removeStaff = (officeId
